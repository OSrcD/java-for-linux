![](https://tcs.teambition.net/storage/3122b8db96236f3fd3da4563b781ef91c333?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMzQ0ODg2MiwiaWF0IjoxNjEyODQ0MDYyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjJiOGRiOTYyMzZmM2ZkM2RhNDU2M2I3ODFlZjkxYzMzMyJ9.-2DukLVcE2cAY_N_r4N7FrklH_Z1xhd1gAXqWx5VTJA&download=image.png "")

![](https://tcs.teambition.net/storage/31228f5b800f22ab963fdb3a47228332a61d?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMzQ0ODg2MiwiaWF0IjoxNjEyODQ0MDYyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjI4ZjViODAwZjIyYWI5NjNmZGIzYTQ3MjI4MzMyYTYxZCJ9.Vu94u_WxMmxSww5Xfv6fOOVNWYD4Jh8LxryF81WmL00&download=image.png "")

![](https://tcs.teambition.net/storage/31222bd98342b6972de6b3f40011f26e0fb7?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMzQ0ODg2MiwiaWF0IjoxNjEyODQ0MDYyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjIyYmQ5ODM0MmI2OTcyZGU2YjNmNDAwMTFmMjZlMGZiNyJ9.AA538maDwH-BF5KmxGp0EGVi3FGERukGSI04e6wJg5g&download=image.png "")

![](https://tcs.teambition.net/storage/312292739746fc5467111f0b3f134228d009?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMzQ0ODg2MiwiaWF0IjoxNjEyODQ0MDYyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjI5MjczOTc0NmZjNTQ2NzExMWYwYjNmMTM0MjI4ZDAwOSJ9.9IsdQ1YDy9V-ti61OLWMRyYLoKNDI47vKaVxl2ilbPU&download=image.png "")

![](https://tcs.teambition.net/storage/3122576e7062e04dfabd8ff3b50c9ce4943f?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMzQ0ODg2MiwiaWF0IjoxNjEyODQ0MDYyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjI1NzZlNzA2MmUwNGRmYWJkOGZmM2I1MGM5Y2U0OTQzZiJ9.HGXT3dQZtUHq2KKvlh2x3MAMGHAyepNVpo74hkkYpt8&download=image.png "")

![](https://tcs.teambition.net/storage/3122b2d8cb857a598557419d395a6f946733?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMzQ0ODg2MiwiaWF0IjoxNjEyODQ0MDYyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjJiMmQ4Y2I4NTdhNTk4NTU3NDE5ZDM5NWE2Zjk0NjczMyJ9._ew7pDVhGhCPY5CJTBPZ7Bo_xrNXDsl_q37LYHnpyjk&download=image.png "")

![](https://tcs.teambition.net/storage/31225fc9d0f4b751bbe92c6bc65fdf27dc0a?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMzQ0ODg2MiwiaWF0IjoxNjEyODQ0MDYyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjI1ZmM5ZDBmNGI3NTFiYmU5MmM2YmM2NWZkZjI3ZGMwYSJ9.VfZ8FJ7ccVe9UKdE3BnVu-fS0ND9XYBSG41XwKFhNdI&download=image.png "")

![](https://tcs.teambition.net/storage/3122f37964a333853dfea51d437c5f430603?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMzQ0ODg2MiwiaWF0IjoxNjEyODQ0MDYyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjJmMzc5NjRhMzMzODUzZGZlYTUxZDQzN2M1ZjQzMDYwMyJ9.Zndn0f7Oz76nArhQiMT2RqFZGxZ_Wjpe3W3O0yaFN0I&download=image.png "")

![](https://tcs.teambition.net/storage/3122abff151dcd288511e8d46b5d8c34c152?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMzQ0ODg2MiwiaWF0IjoxNjEyODQ0MDYyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjJhYmZmMTUxZGNkMjg4NTExZThkNDZiNWQ4YzM0YzE1MiJ9.s1-59IFmp86hf8fBm1CLmRjl4xSO_P6ygtlQFwzugQM&download=image.png "")

![](https://tcs.teambition.net/storage/3122156041b2639ea6eff3eeba7db511faf7?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMzQ0ODg2MiwiaWF0IjoxNjEyODQ0MDYyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjIxNTYwNDFiMjYzOWVhNmVmZjNlZWJhN2RiNTExZmFmNyJ9.3-DgPhulaikR4d3hK2WACDfhLSzJ125Z0dY8ivbGv6s&download=image.png "")

vim service.yaml

```yaml
# v1 最简单的 api version
apiVersion: v1
# Service 类型 叫大类 
kind: Service
# 同一个namespace 名字不能冲突
metadata:
  name: nginx-svc
spec:
  # 不写 type 默认就是 cluster ip 无法让外网进行访问 内部可以沟通
  # 先用 cluster ip 进行相互沟通
  selector:
    # 指定 pod 里的 key
    app: web_server
    name: web_server
  # 指定端口
  ports:
  # 指定协议
  - protocol: TCP
    # 指定服务端口号 内部负载均衡 对外提供的 端口号
    port: 8080    # 我们起的应用 我们知道 什么pod 比如 tomcat 8080 根据我们 docker里面 选img类型 它会把特定应用 起在它容器里
    # 面 相关的 pod 这里就是指容器的 port
    targetPort: 80

```

kubectl get service

![](https://tcs.teambition.net/storage/31227c827d5f1b070cd4be2224dc9b72bbf5?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMzQ0ODg2MiwiaWF0IjoxNjEyODQ0MDYyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjI3YzgyN2Q1ZjFiMDcwY2Q0YmUyMjI0ZGM5YjcyYmJmNSJ9.-m-ULK3eTjeMzV657E3ZoxEbThOOFEO1YckZFo8TT8Q&download=image.png "")

```text
[root@151-k8s-master-CentOS7-Logstash-6 software]# kubectl get service

NAME         TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)    AGE
kubernetes   ClusterIP   10.96.0.1     <none>        443/TCP    144m
nginx-svc    ClusterIP   10.99.60.27   <none>        8080/TCP   43s

```

kubernetes 默认的 service

![](https://tcs.teambition.net/storage/3122301cace712f3e1a19fcb6f1946625187?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMzQ0ODg2MiwiaWF0IjoxNjEyODQ0MDYyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjIzMDFjYWNlNzEyZjNlMWExOWZjYjZmMTk0NjYyNTE4NyJ9.reO-OeQshz3EYmB4tMj3Y3mCnCtN6JcqXeRuc1OBKTQ&download=image.png "")

![](https://tcs.teambition.net/storage/3122aee326368dad92a0fedb8df0bf7baf1d?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMzQ0ODg2MiwiaWF0IjoxNjEyODQ0MDYyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjJhZWUzMjYzNjhkYWQ5MmEwZmVkYjhkZjBiZjdiYWYxZCJ9.vuP48cCJG7MrQKN0A4TjarJPfNc4H2RaVAyT_rehi7g&download=image.png "")

![](https://tcs.teambition.net/storage/31229004e50a7aebee5bf6b5aaf296f7cbad?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMzQ0ODg2MiwiaWF0IjoxNjEyODQ0MDYyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjI5MDA0ZTUwYTdhZWJlZTViZjZiNWFhZjI5NmY3Y2JhZCJ9.R_5-WogBWYI9cwWwd5P6aruxE45GiND10fE3pJDJ77c&download=image.png "")

运行完之后删除

kubectl run  busybox --rm -it --image=busybox /bin/sh 



使用 服务名 方式访问

wget nginx-svc.default:8080

![](https://tcs.teambition.net/storage/31224c1848895295c3a5f6bb551246ee2261?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMzQ0ODg2MiwiaWF0IjoxNjEyODQ0MDYyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjI0YzE4NDg4OTUyOTVjM2E1ZjZiYjU1MTI0NmVlMjI2MSJ9.IaSNzILkApLkjVmsF0s3N_i77w1jf_KNIwcpUocz7CI&download=image.png "")

需要网络环境为小运河



查看 service 详细信息

![](https://tcs.teambition.net/storage/3122b99d8d301de59d2519bace067a6ef065?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMzQ0ODg2MiwiaWF0IjoxNjEyODQ0MDYyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjJiOTlkOGQzMDFkZTU5ZDI1MTliYWNlMDY3YTZlZjA2NSJ9.wZVeuHH4mqWUr_GUSJqvIiDr8ZnDiMgO0szbTcLRSUw&download=image.png "")

![](https://tcs.teambition.net/storage/31222ad3262ffde2e78f539246a8f10b49c5?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMzQ0ODg2MiwiaWF0IjoxNjEyODQ0MDYyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjIyYWQzMjYyZmZkZTJlNzhmNTM5MjQ2YThmMTBiNDljNSJ9.ldq-MH1vT-V5G--YsH5IXWzg-MEUMdSMGhAHZtIlJgM&download=image.png "")

vim service.yaml

![](https://tcs.teambition.net/storage/3122d2b61abf6dd89d3a961762c8814cae04?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMzQ0ODg2MiwiaWF0IjoxNjEyODQ0MDYyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjJkMmI2MWFiZjZkZDg5ZDNhOTYxNzYyYzg4MTRjYWUwNCJ9.i2LlAdDiInIY3luFShlL9pPS5qSjUTNb636DiDNLCDI&download=image.png "")

```yaml
# v1 最简单的 api version
apiVersion: v1
# Service 类型 叫大类 
kind: Service
# 同一个namespace 名字不能冲突
metadata:
  name: nginx-svc
spec:
  # 指定类型不再是默认的Cluster ip
  type: NodePort
  # 不写 type 默认就是 cluster ip 无法让外网进行访问 内部可以沟通
  # 先用 cluster ip 进行相互沟通
  selector:
    # 指定 pod 里的 key
    app: web_server
    name: web_server
  # 指定端口
  ports:
  # 指定协议
  - protocol: TCP
    # 指定物理端口 只有指定端口 才能映射到 我们外网地址
    nodePort: 30000
    # 指定服务端口号 内部负载均衡 对外提供的 端口号
    port: 8080    # 我们起的应用 我们知道 什么pod 比如 tomcat 8080 根据我们 docker里面 选img类型 它会把特定应用
 起在它容器里
    # 面 相关的 pod 这里就是指容器的 port
    targetPort: 80

```

![](https://tcs.teambition.net/storage/3122d7a5fcd0eddd8c618db2ae83ddec153c?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMzQ0ODg2MiwiaWF0IjoxNjEyODQ0MDYyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjJkN2E1ZmNkMGVkZGQ4YzYxOGRiMmFlODNkZGVjMTUzYyJ9.76bNLF4S4Y-eKZjQ9_RvRXm5vks91DuzzJH7uW8fm2M&download=image.png "")

![](https://tcs.teambition.net/storage/31222f2fc0812c837300f540685360b553da?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMzQ0ODg2MiwiaWF0IjoxNjEyODQ0MDYyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjIyZjJmYzA4MTJjODM3MzAwZjU0MDY4NTM2MGI1NTNkYSJ9._2eqT_ttKM2BOGQvrJfz0DfSJhRf930ePRw_MH2-6cs&download=image.png "")

![](https://tcs.teambition.net/storage/3122f364d462241dc9c06e6ebb983433bffc?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMzQ0ODg2MiwiaWF0IjoxNjEyODQ0MDYyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjJmMzY0ZDQ2MjI0MWRjOWMwNmU2ZWJiOTgzNDMzYmZmYyJ9._2au92hcxjSLdcjFOhV7Q2ubPxZlKkFnXov_hXyvd1w&download=image.png "")

![](https://tcs.teambition.net/storage/312295dc35a8481c1bf7afc0e10158532852?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMzQ0ODg2MiwiaWF0IjoxNjEyODQ0MDYyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjI5NWRjMzVhODQ4MWMxYmY3YWZjMGUxMDE1ODUzMjg1MiJ9.rrn2SmY3-95BfplSzvPoBIbjo1oB21_-Vl2uNOuSrWU&download=image.png "")

这里的 ingress 是数据流 进来

egress 是数据流出去



![](https://tcs.teambition.net/storage/3122a5c6da39a7545f71613da46ef3185595?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMzQ0ODg2MiwiaWF0IjoxNjEyODQ0MDYyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjJhNWM2ZGEzOWE3NTQ1ZjcxNjEzZGE0NmVmMzE4NTU5NSJ9.ruZSZ0LoFqN8bAjP7_Oj-1n2ZEeDOeSXJ5buU7TueUs&download=image.png "")

7 层的 http  负载均衡器 或者反向代理的概念 



![](https://tcs.teambition.net/storage/3122b2ebfc51f4f49bb13e1c9f117d5fd80a?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMzQ0ODg2MiwiaWF0IjoxNjEyODQ0MDYyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjJiMmViZmM1MWY0ZjQ5YmIxM2UxYzlmMTE3ZDVmZDgwYSJ9.SLQSdAG39gTHzaYiTRJyajJasBM4EHpIOA3HPqxkwS0&download=image.png "")

vim policy.yml

![](https://tcs.teambition.net/storage/3122fbb64d4fe929c497580ea3a235efc966?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMzQ0ODg2MiwiaWF0IjoxNjEyODQ0MDYyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjJmYmI2NGQ0ZmU5MjljNDk3NTgwZWEzYTIzNWVmYzk2NiJ9.p89MBPMPnnA6GmiXOEDklLOhly7m0HoGlKLxEhs27P0&download=image.png "")

```yaml
# 专用的 policy api
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: access-nginx
spec:
  # 什么样的pod应用 selector
  podSelector:
    matchLabels:
      app: web_server
  # 数据流进来 从那些 pod 有一个label access 为 true 的 pod 就可以访问 它
  ingress:
  - from:
    - podSelector:
        matchLabels:
          access: "true"
    # ip 段 指一大块的 意思  可以访问应用
    #- ipBlock:
    #    cidr: 10.244.0.0/16
    # 指定端口
    ports:
    - protocol: TCP
      port: 80

```

![](https://tcs.teambition.net/storage/31224f84a4c403ec41a86ff7ce471ae6ddfa?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMzQ0ODg2MiwiaWF0IjoxNjEyODQ0MDYyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjI0Zjg0YTRjNDAzZWM0MWE4NmZmN2NlNDcxYWU2ZGRmYSJ9.vUya_N_qw1ynrv5T_slVUNC8JlMpNaquHXUVJhB7-UM&download=image.png "")

![](https://tcs.teambition.net/storage/31224c22f30a9673a2b84ba69eb2e1d31f7c?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMzQ0ODg2MiwiaWF0IjoxNjEyODQ0MDYyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjI0YzIyZjMwYTk2NzNhMmI4NGJhNjllYjJlMWQzMWY3YyJ9.R4MjgwMq8gVF3FLtdXE6zM7Hjz1xqrb-E5ryzgaAGkc&download=image.png "")



添加变量 kubectl run busybox --rm -it --labels="access=true" --image=busybox /bin/sh

![](https://tcs.teambition.net/storage/31221d85c144ccbdfe89de43948c16f944ef?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMzQ0ODg2MiwiaWF0IjoxNjEyODQ0MDYyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjIxZDg1YzE0NGNjYmRmZTg5ZGU0Mzk0OGMxNmY5NDRlZiJ9.lzwGXNoW8kSNruZoO8w5dpYiBGB1eWeAdhbkwhvfqJs&download=image.png "")

![](https://tcs.teambition.net/storage/31224301d7c0d9ee326ba7040cd3f4efba37?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMzQ0ODg2MiwiaWF0IjoxNjEyODQ0MDYyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjI0MzAxZDdjMGQ5ZWUzMjZiYTcwNDBjZDNmNGVmYmEzNyJ9.zF9mhcq3vIURHu9TsxCfyVFvbhcU5cHVIcWbjUUNw78&download=image.png "")

![](https://tcs.teambition.net/storage/3122fe8b8daf6e790f4f696e7320909b7f87?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMzQ0ODg2MiwiaWF0IjoxNjEyODQ0MDYyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjJmZThiOGRhZjZlNzkwZjRmNjk2ZTczMjA5MDliN2Y4NyJ9.VdXSztxL5kNbten0F8htqxp3qHoO0kAgWokGqOWWA_0&download=image.png "")

Master访问卡住了

![](https://tcs.teambition.net/storage/3122cf9442907c42ca64725b4d0cc595a56d?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMzQ0ODg2MiwiaWF0IjoxNjEyODQ0MDYyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjJjZjk0NDI5MDdjNDJjYTY0NzI1YjRkMGNjNTk1YTU2ZCJ9.vrbbvSJ8ObFyPTFJhERTV0vCxmb-JzCiiPdAOKOYyHw&download=image.png "")

![](https://tcs.teambition.net/storage/312288d96c59b9038c6f445332aea4b774e1?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMzQ0ODg2MiwiaWF0IjoxNjEyODQ0MDYyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjI4OGQ5NmM1OWI5MDM4YzZmNDQ1MzMyYWVhNGI3NzRlMSJ9.CnUAIbmzXValnRKHvE9ybr17LEXIzXpnDqHNigXp9Zo&download=image.png "")

```yaml
# 专用的 policy api
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: access-nginx
spec:
  # 什么样的pod应用 selector
  podSelector:
    matchLabels:
      app: web_server
  # 数据流进来 从那些 pod 有一个label access 为 true 的 pod 就可以访问 它
  ingress:
  - from:
    - podSelector:
        matchLabels:
          access: "true"
    # ip 段 指一大块的 意思  可以访问应用
    - ipBlock:
        cidr: 10.244.0.0/16
    # 指定端口
    ports:
    - protocol: TCP
      port: 80
                                                                      17,3         全部

```

![](https://tcs.teambition.net/storage/3122dc78ed7466c3f98a81b77178f7672300?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMzQ0ODg2MiwiaWF0IjoxNjEyODQ0MDYyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjJkYzc4ZWQ3NDY2YzNmOThhODFiNzcxNzhmNzY3MjMwMCJ9.YGY1LwpVq2aFPHpfScHh0pFsQUlnCa5Y2Ua4Y9amdKM&download=image.png "")

![](https://tcs.teambition.net/storage/3122876c0505bc1f50cf6ee59b1cf305d4ec?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMzQ0ODg2MiwiaWF0IjoxNjEyODQ0MDYyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjI4NzZjMDUwNWJjMWY1MGNmNmVlNTliMWNmMzA1ZDRlYyJ9.tI5okey4DdeZ8QtcIXRic1bMdA0dsYYVcdsYdvDzBa4&download=image.png "")



开源笔记

可 Pull Requests 协作写开源笔记

如果笔记图片无法访问 请访问 [teambition](https://tburl.in/0jDNvpbK) 原版开源笔记

gitee

[https://gitee.com/opendevel/java-for-linux](https://gitee.com/opendevel/java-for-linux)

github

[https://github.com/OSrcD/java-for-linux](https://github.com/OSrcD/java-for-linux)

teambition

[https://tburl.in/0jDNvpbK](https://tburl.in/0jDNvpbK)

开源视频

bilibili

[https://space.bilibili.com/77266754](https://space.bilibili.com/77266754)

开源博客

oschina

[https://my.oschina.net/u/4675154](https://my.oschina.net/u/4675154)

csdn

[https://blog.csdn.net/OpenDevel](https://blog.csdn.net/OpenDevel)

开源项目

gitee

[https://gitee.com/opendevel](https://gitee.com/opendevel)

github

[https://github.com/OSrcD](https://github.com/OSrcD)

开源赞赏

![](https://tcs.teambition.net/storage/3121aed56e96d914e1046f3b498b493ce232?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMzQ0ODg2MiwiaWF0IjoxNjEyODQ0MDYyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjFhZWQ1NmU5NmQ5MTRlMTA0NmYzYjQ5OGI0OTNjZTIzMiJ9.-stjQhj-Oq1ukb23LV5SKOX8xTwBe37RM-AHEzFYSFU&download=image.png "")

