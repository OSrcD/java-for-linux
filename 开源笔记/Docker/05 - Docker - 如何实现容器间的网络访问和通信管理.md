

![](https://tcs.teambition.net/storage/312221c7712c151595dd7c90818f7f3b1ddc?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjg2NDg0MywiaWF0IjoxNjEyMjYwMDQzLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjIyMWM3NzEyYzE1MTU5NWRkN2M5MDgxOGY3ZjNiMWRkYyJ9.1Rk4nfnBt5cULNfDnGKnnzyqFjx-FrZG21gOuEXHi9s&download=%E6%9C%AA%E6%A0%87%E9%A2%98-1.png "")

![](https://tcs.teambition.net/storage/3122e4518195e7496016f193e35a702c80eb?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjg2NDg0MywiaWF0IjoxNjEyMjYwMDQzLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjJlNDUxODE5NWU3NDk2MDE2ZjE5M2UzNWE3MDJjODBlYiJ9.8DmyRzPXOnZG-hw5wqb56No-sOKP1yd7ZOBQjrAC7gs&download=%E6%9C%AA%E6%A0%87%E9%A2%98-2.png "")



![](https://tcs.teambition.net/storage/3122f5dbcb8d30a622308edb17fc19028e4c?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjg2NDg0MywiaWF0IjoxNjEyMjYwMDQzLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjJmNWRiY2I4ZDMwYTYyMjMwOGVkYjE3ZmMxOTAyOGU0YyJ9.nI_LejHDjBspndI8i40sPz_8bE18RZP_RHQivUlBOJM&download=image.png "")

none 无网络

host 主机网络

bridge 桥接网络



可以自定义间接网络

overlay 上层连接网络

macvlan mac层的虚拟机网络

flannel 法兰绒网络

weave 针织布网络

calico 印花布网络



![](https://tcs.teambition.net/storage/3122a63a6d8993e9d5fd971d630f40ea91db?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNTQ2ZDkyODI1NWU3ZjU1MzkxZmUwOSIsImV4cCI6MTYxMjg2NjUyNCwiaWF0IjoxNjEyMjYxNzI0LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjJhNjNhNmQ4OTkzZTlkNWZkOTcxZDYzMGY0MGVhOTFkYiJ9.v9XPL1I--5xAsMWPHNn7HBCx7aR1Vf9LBFoTl8XyfSk&download=image.png "")

none网络

这个容器起来以后 做业务数据处理 

跟服务器有数据交流

跟外网没有任何交流





![](https://tcs.teambition.net/storage/312263118cadd8d9769a873e161b6f3e13d1?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNTQ2ZDkyODI1NWU3ZjU1MzkxZmUwOSIsImV4cCI6MTYxMjg2NjUwMywiaWF0IjoxNjEyMjYxNzAzLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjI2MzExOGNhZGQ4ZDk3NjlhODczZTE2MWI2ZjNlMTNkMSJ9.B_B1b2WGi2qbBUzcM312Gia7MOVvt6L5tCRHPayJ8Hs&download=image.png "")

host 网络

当访问者发指令给服务器 同时 其实也发给了容器 

容器和服务器之间采取端口争夺的方式 



![](https://tcs.teambition.net/storage/3122546e35567207c0ee7a126b2a4d5ff0f8?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNTQ2ZDkyODI1NWU3ZjU1MzkxZmUwOSIsImV4cCI6MTYxMjg2Njc5NywiaWF0IjoxNjEyMjYxOTk3LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjI1NDZlMzU1NjcyMDdjMGVlN2ExMjZiMmE0ZDVmZjBmOCJ9.2-uhHyiQn24zeE2M0tJmCpw1mTF6tJwLPNkd9YFUvH0&download=image.png "")

bridge

跟外互联



应用访问服务器 会通过 docker 0 做一个端口映射 



![](https://tcs.teambition.net/storage/312282c481f96b85ad367490362b81621582?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNTQ2ZDkyODI1NWU3ZjU1MzkxZmUwOSIsImV4cCI6MTYxMjg2Njk3NSwiaWF0IjoxNjEyMjYyMTc1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjI4MmM0ODFmOTZiODVhZDM2NzQ5MDM2MmI4MTYyMTU4MiJ9.ZOzk9ChY1xujJ1BvU16PsV5XmHSCbcMHygYhxRvUsgE&download=image.png "")

同样的网桥环境当中







overlay 

![](https://tcs.teambition.net/storage/312298d011ab71aa0e906ec6eeea1d18b1b3?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNTQ2ZDkyODI1NWU3ZjU1MzkxZmUwOSIsImV4cCI6MTYxMjg2NzczNywiaWF0IjoxNjEyMjYyOTM3LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjI5OGQwMTFhYjcxYWEwZTkwNmVjNmVlZWExZDE4YjFiMyJ9.Nhyb5RMv6KiYop58q2_nju3x-mq6wGbKbO0wOiQ701I&download=image.png "")

多个容器之间的互通

形成容器之间的集群

两个物理服务器 它有一个依赖条件 要共享键值对的service consul

可以人工建 也可以在容器里面建 不管怎么样要建出一个服务

在我们docker 命令里面去创建一个 overlay 网络 要跑一个这样命令



在跑的时候要把 docker 守护进程 指向这个 consul

这个时候 你建出这个网络 另外一个指向同一consul 服务器的 docker 守护进程 也会同时建出一模一样 br0里面的 网桥

两个br0 之间呢 会实现 大二层连接 自动的过程 只要你把两台服务器 守护进程 指向同一个consul 这样实现好处 在服务器1 里 起的容器 跟服务器2 起的容器 其实都互联在同一个大二层



大二层 可以理解为是 你是公司A  我是公司B  是两个不同的网络 

但我希望 我们这两个公司 里面有两个人 成立一个虚拟子公司 

这样我们之间的交易 在虚拟子公司内部划账就可以了 

这个虚拟子公司 就是在网络层上的一个 大二层



两个服务器想有 类似的网段



比如 10.6.1.2

         10.6.1.3



它们之间可以很方便进行互通





macvlan

![](https://tcs.teambition.net/storage/312226c2c6cfede9e7a52b135f5cdc5a503e?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNTQ2ZDkyODI1NWU3ZjU1MzkxZmUwOSIsImV4cCI6MTYxMjg2ODA3MCwiaWF0IjoxNjEyMjYzMjcwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjIyNmMyYzZjZmVkZTllN2E1MmIxMzVmNWNkYzVhNTAzZSJ9.IJu6E6Cj4XvfLudG8Zlm2eO6wmvVz32kizYRAvhdXHU&download=image.png "")

我在创建一个特殊的vlan 把这两个 mac 地址互相串起来

也不用第三方服务做支撑 

串起来以后 当你起容器的时候 如果是用这样一对 互通的 mac来进行沟通

感觉这4个容器 在一个IP地址上 在一个以太网绑着

它们之间可以很方便用同一个 mac vlan 沟通



当你第2对 mac vlan  可以绑一堆其他容器  

服务器要处于混杂模式  

可以实现容器互通  不能实现访问者的沟通





flannel

![](https://tcs.teambition.net/storage/312220028db40e32fc1cf368faafab9f1fd6?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNTQ2ZDkyODI1NWU3ZjU1MzkxZmUwOSIsImV4cCI6MTYxMjg2ODU2MCwiaWF0IjoxNjEyMjYzNzYwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjIyMDAyOGRiNDBlMzJmYzFjZjM2OGZhYWZhYjlmMWZkNiJ9.JzotFo14DYt0_-Sr_tk4HwsZIHQCszgm43mQlX2faDc&download=image.png "")

要实现访问者的沟通 

要搭建一个配置 键值对服务器 etcd 把所有docker 守护进程跟它之间进行沟通

沟通完以后  我们在建立网络的时候 可以同时在多个 docker所在的虚拟机 上面 或者服务器上面 建出 flannel.1 号 VxLAN 大二层网络 同时 我们起容器的时候 我们会把容器 docker 0 网桥 自动绑在这个 flannel.1 地毯上  4个 容器 2个服务器 都 躺在同一个地毯 它们可以很方便进行互通

同时 容器连的都是docker 0 所以 docker0的优势 nat 外面访问它们 通过pat 进行端口映射 

它们也可以很方便访问外面 用 nat 进行外网访问 

 

weave 

![](https://tcs.teambition.net/storage/3122bc9d343f35a664be1f1ba01800605003?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNTQ2ZDkyODI1NWU3ZjU1MzkxZmUwOSIsImV4cCI6MTYxMjg2ODk3NSwiaWF0IjoxNjEyMjY0MTc1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjJiYzlkMzQzZjM1YTY2NGJlMWYxYmEwMTgwMDYwNTAwMyJ9.WMNt_Ff_1PJ9T58fYC8mvv9hfpTANJwpMZaiKKLeFb0&download=image.png "")

在容器启动的时候 会尝试加入两个网络 

一个是网桥网络 一个是weave 数据流 数据通道网络

这两个 weave 通过配置 可以实现它们之间互通 你的 weave和我的weave 是一块布



同时 外网的应用 我要访问容器 也可以直接把外网 应用 去访问这个实际的ip地址 

ip地址可以实际绑定 这个  weave 上 可以把我们服务器ip地址 直接绑上去 

将外网数据流 直接 通过weave 访问我们的这个容器 类似我们端口映射的感觉 



Nginx 很少还要从外网去拿一个包来安装自己 



对外访问集群 但从来不访问外面 资源



calico

![](https://tcs.teambition.net/storage/3122852f56cce4a2c246569c70f9723c05ef?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNTQ2ZDkyODI1NWU3ZjU1MzkxZmUwOSIsImV4cCI6MTYxMjg2OTMxNiwiaWF0IjoxNjEyMjY0NTE2LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjI4NTJmNTZjY2U0YTJjMjQ2NTY5YzcwZjk3MjNjMDVlZiJ9.2y3EUNPfWE3fJy7_CNtKJVIymeTWqbzuzTkp1aR825c&download=image.png "")

准备一个etcd的键值对配置环境

通过守护进程 去把两个服务器进行跟它的docker 守护进程 沟通 

当你创建新的calico网络的时候 对方也可以创建它的calico网络

它们之间是通过BGP路由协议进行互通  这个路由协议是网络层协议

所以你会看到 容器 1 2 3 4 很方便通过路由协议进行互通 也可以很方便 通过路由协议去访问外网资源 但是有一个很大的限制 这套路由协议 它的内网都是用内网地址 虽然 它的内网地址 可以通过路由 转换去访问外网资源 但是通常很少有用户 直接把这个 网络暴露给外网

外网很少直接访问 calico





















































开源笔记

可 Pull Requests 协作写开源笔记

如果笔记图片无法访问 请访问 [teambition](https://tburl.in/0jDNvpbK) 原版开源笔记

gitee

[https://gitee.com/opendevel/java-for-linux](https://gitee.com/opendevel/java-for-linux)

github

[https://github.com/OSrcD/java-for-linux](https://github.com/OSrcD/java-for-linux)

teambition

[https://tburl.in/0jDNvpbK](https://tburl.in/0jDNvpbK)

开源视频

bilibili

[https://space.bilibili.com/77266754](https://space.bilibili.com/77266754)

开源博客

oschina

[https://my.oschina.net/u/4675154](https://my.oschina.net/u/4675154)

csdn

[https://blog.csdn.net/OpenDevel](https://blog.csdn.net/OpenDevel)

开源项目

gitee

[https://gitee.com/opendevel](https://gitee.com/opendevel)

github

[https://github.com/OSrcD](https://github.com/OSrcD)

开源赞赏

![](https://tcs.teambition.net/storage/3121aed56e96d914e1046f3b498b493ce232?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjg2NDg0MywiaWF0IjoxNjEyMjYwMDQzLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjFhZWQ1NmU5NmQ5MTRlMTA0NmYzYjQ5OGI0OTNjZTIzMiJ9.pcN_O_6BbgtZBM4tIt8eX5bPgxUVZeV__us0sQCaOoM&download=image.png "")

