



![](https://tcs.teambition.net/storage/312137059be4d1d865855aebea60981dd3e5?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDQ4NywiaWF0IjoxNjExNDY1Njg3LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjEzNzA1OWJlNGQxZDg2NTg1NWFlYmVhNjA5ODFkZDNlNSJ9.24ToexphT3vNUgjnFe8ZPd1MXImj9LFcjv6pgdrxCkc&download=1.png "")

这一简单 我们来聊一聊 如何做主链路的规划

不知道同学们在自己的项目中有没有认真考虑过 什么是主链路

没有 嗯 我想有可能是系统太过简单

用户场景并不那么复杂

又或者呢 是用户量访问并不大 我们没有必要保卫主链路 还有可能啊 大家并没有理解什么叫做主链路

那这里在开始之前呢 我先跟大家说一说 什么叫做主链路

拿我们一个人的人生做比较啊

什么才是人生中的主链路呢

谈恋爱 上学找到好的工作 哎呀 这些都太浮夸了 真正的主链路啊就有两个字 活着

那围绕活着这个主链路呢 它可能有四个业务场景 分别是吃喝拉和撒

没有这四样基础啊 你人生中的所有重要活动都无法开展 所以对我们每个人来说 主链路就是活着

整个一条人生的主线啊 都是围绕着这个主链路来展开的

所以呢 主链路 对于一个系统来说 它是最最核心的一个业务流程

如果主链路的任何一个环节出了问题啊 那对你整个系统来说都是一个灾难性的结果

尤其对于互联网项目啊 这种用户基数非常非常大 访问压力非常高的应用来说

识别出正确的主链路 动用一切的资源保障主链路不失手 是重中之重的任务

那这里就牵扯到一个问题啊 如何识别出你重要的业务主链路

再回到人生这个例子啊 有的同学说谈恋爱是自己的主链路

那可能谈恋爱对他非常重要 对不对 小情侣一分手了 男的鬼哭狼嚎 宝贝儿 没有你我就活不下去啊

煽情的话说的再多也不管用 男人的嘴骗人的鬼

你把他甩了 他可能过得更潇洒吧 虽说谈恋爱对人生来说是不是主链路啊 你没有谈恋爱人生就过不下去啦 不是那么回事

因此 这个主链路可不是你随便以为哦 我很重要 然后它就是主链路了nonono

我们要基于一定的事实基础来识别出整个系统 整个业务流程中 最核心 最k的那个环节



接着前面讲的内容啊 我们这里来探讨一下主链路保卫战中三个核心要素

就像打一场战争一样 你要知道你的主战场是哪里

海量的用户请求啊 就像不断来犯的这个敌军一样

你要知道在哪里需要不重兵来把守 这样才能在有限的资源内保障系统最大的可用性

达到什么效果啊

怎么来识别这个主 链路非常简单

在电商场景啊 我们有一个原则 叫什么

一切向钱看 哪一个钱 money这个钱

所以说啊 在整个主链路的识别过程中 它的主线剧情就围绕着前这个东西来展开

你的系统中直接导向利润生成的部分往往就是最核心的主线

我们很容易想到订单系统对不对 你直接牵扯到下单

如果这个环节失手了 用户下不了单了 那你的钱从哪里来啊

再比如说订单系统后面的支付引擎 这个扣款动作完成不了 那你钱是不是还拿不到啊

所以大家记住 我们互联网人啊 是非常纯粹的

一切跟钱过不去的问题啊 那就是跟我们自己过不去 所以这个钱一定是主线中的主线

除了钱以外还有一个要素叫什么呀 我们叫他流量

你的钱从哪里来 从用户上来 用户从哪里来 同学们是不是我们的导流端引过来的流量

比如说全国各地铺开这么多的莆田系医院

那个医院挂号处的收费系统是不是主链路啊

没错 因为那关系到这个医院的钱从那里来啊 但是更重要的是他们的流量从哪来啊

那这些莆田系的医院啊 它的流量往往通过一些搜索引擎过来

哦 我这里说一些搜索引擎 可能地图画开的有点大 莆田系医院的流量往往只从某个比较大的在线中文搜索引擎中过来啊

所以说对于莆田系医院来说 那这个搜索引擎啊 也就是流量的入口

他更是需要保卫的主链路了 没有了这个流量入口 那就像无缘之水一样 这些假医院还怎么去骗人呢 对不对

所以总结一下主链路中 钱和流量是两个最核心的考虑要素

当我们正确识别的主链路以后 我们接着要考虑这样一个问题啊

底线

做人呢得要有底线 做主链路同样也要有底线

这个底线 它在哪里呀 它是由你来定的 你要清楚的知道当前业务的最小可用性在哪里

怎么来理解这个问题呢 我举一个例子啊

比如 在下单结束后的支付链路中 我们网站可能提供了很多种支付方式

比如支付宝支付啊微信支付啊银联支付啊等等等等

假如你某些支付渠道不可用了 那么你的主链路有没有崩坏呢

并没有 那我作为业务方 我可以给这个支付系统设置一个底线是什么呢 就是说保障至少有一种服务可用

比如你四种支付渠道坏了三种 那么你保住了最后一种 这整个主链路依然是通畅的 对不对

它可能会对你的利润造成一定的影响 但是总的来说 你要保证整个主链路是通畅的 可以从头走到尾

不过呢 一旦你的系统可用性突破了这个底线

比如四种支付渠道团灭了

在这个整个主链路环节中 就一环断掉了 那我们只能宣告主链路失手

所以在这个底线上啊 为了保证业务的最小可用性 我们可是要花足心思

利用各种的熔断降级补偿 总之是八仙过海 各显神通 力保底线不失

ok 前面的主线剧情啊和底线 我们分别讲了如何能在抵抗住敌人正面进攻的情况下采取积极的策略

那么假如敌人的攻势太猛 我不小心失手了怎么办

这也是主链路保卫战中要着重思考的一个问题啊 那就是故障恢复 这个做法呢那就是百花齐放了

比如在支付系统中 我们可以采用异常的补偿机制来实现故障恢复怎么来理解呢

比如 我们的扣款请求已经发送到了银行那里

但是在我们的系统中 因为种种原因导致 这个扣款请求并没有被记录下来

这种情况下 用户在你的系统中看到这笔扣款并没有正式发生 但是在银行那边他的钱却被扣了 怎么办呢

这就要求我们在系统中实现一个对账功能 将你系统中的记录和银行端的记录进行一个匹配

通常来讲 我们做银行基层的时候 经常会听到一个词叫statementfive 包括一些国外银行也是通过这种文件形式的对账

那么我们通过对照发现了异常交易

就可以针对不同的情况做出相应的补偿机制 比如前面的例子啊

我们发现银行的文件中有这条记录 而本地系统中却没有 那么怎么办呢 很简单 把这条缺失的记录在本地的系统中重建起来就可以了

我给这里只是举了一个例子啊 真实的业务场景远远比这个例子要复杂的很多很多

比如我做阿里新零售业务 商品中心落地的时候 针对商品发布的每一个环节 它所可能的异常情况都有一个相应的补偿机制

整个流程下来 你为了处理各种异常情况所写的代码是远远多于正常情况的

那故障恢复还有一个思考的方向就是什么呀 就是前面我们学习的降级方案

这里并不是说所有的降级都是为了故障恢复啊 有些是寂寞降级 可能只是为了安抚一下用户

但是呢 有些降级确实是从故障恢复的角度来做的 比如说我发现服务不可用 数据库连接断掉了 对不对

那我本来想像数据库插入一条记录 那现在做不了了

那我在对应的降级逻辑中 是不是可以把这条记录暂存在某一个地方

然后等待后续流程 从这个地方把数据恢复起来 以后再查不到数据库呢

那这里只是一个思考的方向了

降级方案五花八门 出发点啊也各不相同 这里只是说我们可以利用降级方案这种途径来达到故障恢复的目的

ok 这一节我们主要讲了在互联网的场景中 尤其对于电商系统来说 识别主链路的两大要素 money trific

以及保卫主链路的底线是要确保业务的最小可用性

并且在正面战场以外 我们有一个敌后战场 叫做故障恢复

尽可能的对所有的异常情况进行补偿 ok 那我们进入下页





![](https://tcs.teambition.net/storage/3121a2d07a21096850115b48ebe5de08d71a?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDQ4NywiaWF0IjoxNjExNDY1Njg3LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjFhMmQwN2EyMTA5Njg1MDExNWI0OGViZTVkZTA4ZDcxYSJ9.yvJjNS1oH90BvByswsDrCxKzpEslwy4in-JtoE5yuiQ&download=3.png "")

好 这一页就开始热闹起来啦 我们首先来从导流端看一看主链路规划中的几个实践的方向

我们拿商品详情页来举例啊

大家想一想总共有哪些途径可以将一个用户流量

从外部导入到淘气的商品详情页呢 我这里举几个例子啊比如淘宝客可不可以呀

它是淘气的一个分销系统 大家可以通过自己的广告链接了赚一些外快 这是一种方式啊 除了这个以外呢

有一些合作的推广平台 第三方的返利平台等等

当然 抛开了外部推广以外 我们还有自有的流量 对不对

比如说打开手淘 我们所有的用户就可以通过站内搜索来导向具体的商品相机 这个叫内部流量

除了站内搜索以外还有哪些内部流量呢

比如说用户画像推荐 那这是推荐算法的一部分

大家在网站上经常可以看到边玩或者是下单页的底部有一些商品推荐 对不对 这就是根据你的用户画像做的定制化推荐

除了这些以外呢 当然还有内幕渠道业了

喜欢美妆的小姐姐们或者喜欢潮牌的小哥哥们可以到对应的美妆内幕或者是潮牌内幕下面进行更细致的搜索

当然啦 导流的途径远远不止这些 这里只是跟大家提几个比较常用的途径

他们通通构成了导向商品详情业的用户导流端

那在这些导流端中 我们如何来识别哪一个是核心主链路呢

你看 我答案都已经给出来了 我都把它标成红色了 是站内搜索对不对

为什么站内搜索成了核心的主链路 而不是其他途径呢

因为我们要针对导流效果的实际情况来甄别 哪儿一个才是核心的主链路

这就牵扯到访问量乘以转化率 最终到达商品详情页的真实用户的数量

它有两方面的含义 一方面是你的转化效率

另一方面是你转化来的用户基数 两个指标同样都重要 但是这里更关注的是转化的基数

那我们说这几种导流端的方式有可能淘宝客的转化率相对较高 或者用户画像推荐相对较高

因为他更抓住了用户感兴趣的内容 如果用户不感兴趣 他不会来点击 对不对

因此 它将一个用户请求转化成一个真正的付款订单的概率可能是相对较高的 但是它的访问量基数并不是那么大

所以他最终转化成的订单数量并不是一个很大的数字

而站内搜索不一样 尽管它的转化率并不高 但是由于用户的访问请求主要是来自于手淘页面的站内搜索

虽说在这种巨量的访问请求加持下 你即使是一个并不那么高的转化率 最终也会拿到一个很好看的转化量数字

因此 从这个角度来说 站内搜索是一个核心的主链路

那么从商品详情页往下看啊 这里的内容就多了 我挑选几个相对有代表性的服务啊

一个是评论服务

那好评 差评 中评 还有买家秀啦还有追评 这些都构成了你对当前商品的印象 参考

它可能会影响到你最终的下单行为

紧接着我们来看ump营销服务 ump这里是什么呢 是淘气中的一个营销优惠计算引擎

整个阿里系的应用都会介入到ump服务中进行优惠计算

在商品详情页上 它可以透出一些优惠信息

比方说当前100块钱 我打了九折是90块钱 或者说当前商品呢 可以用某些优惠券

因此 它是一个优惠信息从后台到前台内透出 那我们来看评论服务和ump营销服务

这两个服务 它都会影响到你最终的付款行为 对不对

但是假如没有这两个服务 在在商品详情页上 你是否还能完成下单动作呢 是可以的

因此 从这个角度来看 尽管这两个服务非常的重要

但是假如他挂掉了你的主链路能否继续完成呢 当然没问题

那么 也就是说 这两个服务并不是最核心的主链路 你抛掉它依然可以下单成功

大家可能以为啊 我在商品详情页上看不到优惠 那么下单时候也就不会应用优惠规则了 是这样的吗

其实不是在淘气链路中商品上的优惠计算和购物车上优惠计算 甚至下单页的优惠计算是完全不同的服务

因此 对于商品业来说 你即使营销服务挂掉了

没关系 他并不影响你在最终结算订单时候的优惠计算 ok 那我们继续往下看啊

这里看到了一个很特殊的概念 叫SKU

经常做电商系统的同学 应该非常了解SKU啊 它是什么含义呢

比如你到了情人节想给女朋友买花

店家提供了很多种不同的规格

比如玫瑰花 比如康乃馨 比如蓝色妖姬这每一种类型啊 我们都叫SKU

在比如我们大家买衣服的时候是不是要选择尺码呢 还有颜色

那这些尺码颜色的组合 我们把它叫做SKU

它是当前商品下设的一个此类目的概念

通过SKU之间的组合 最终确定了你所下单的商品 它是什么类型的规格 所以我们看它是不是主链路

他一定是很核心的主链路 因为假设你没有SKU的话

那我买一件衣服 我怎么选择尺码 我怎么选择颜色 难道随便给用户计码不可能的

因此 sku在商品详情页中一定是一个非常非常重要的 绝对核心主链路的部分

那我们接着往下看啊库存服务是不是假如你库存服务挂掉了 你怎么知道当前商品还可以继续往后走下单流程呢

比如说 你的库存当前已经是零了

你在商品详情页点击的加购物车行为包括后面购物车的下单行为 一定要把商品跟库存强绑定起来

如果你的库存是零那么你还能继续下单吗 如果可以的话 那就要产生超卖现象了

卖家可能发不出货 虽说库存不光是详情页 它是整个电商链路中一个非常核心的主链路

他决定了你这个商品是可卖还是不可卖 如果可卖的话 那么可以卖多少 ok 我们继续往后看

这里提到了一个TFS富文本详情 详情它是什么呀

那大家在浏览商品详情的时候 是不是看到下面有很多的图片 包括文字介绍 甚至有一些短视频啊

那这里实际上是一个tfs的link 也就是一个链接

在这个链接中可以获取他的富文本详情 那么这个富文本详情对于用户下单来说是一个非常重要的强参考因素

即使你没有商品详情中的富文本内容 用户也可以下单

但是他正像盲人摸像一样啊 他连你这个商品详细的任何说明都没有看到 那直接下单了 那这真的就是真爱了或者是老用户

因此 我们说 尽管在不需要TFS富文本详情的情况下 用户依然可以完成下单动作

但是 由于这个富文本详情是对用户下单有一个强引导作用 它对转化率的影响是非常非常大的

因此 我们把它也放为主链路中的一部分了

但是在主链路中的优先级呀可能比不上前面的sku和库存

所以呢 在整个主链路的流程中啊 大家每一个服务功能也是要量山好汉排座次的

那我继续往后看啊

这里来了一个叫图片空间 图片空间是什么东西呢 我们在想企业中看到的图 包括商品的几个滚动图片的主图

它就是存放在淘气图片空间中的内容 这也是一个会强印象转化率与用户下单行为的要素 所以我们这里把它标黄啊

也就是说没有它依然可以完成主链路 只不过它的重要性呢 相对于评论服务这类功能来说 会更重要那么一些

我可以接下来我们看一个打酱油的角色顽兔视频空间什么鬼啊大家放的短视频了对不对

其实我购物的时候基本都不会看里面的视频啊 我觉得太啰嗦了 通常看一看主图 看一看评论 看看详情就可以了

那么这个打酱油的视频空间啊也就算是一个锦上添花的功能吧

 我们理了两个方向 一个是导流端流量方向 一个是商品详情页内置功能这个方向

在这两个方向上啊 我们分别识别了一些主链路 相信大家对什么叫做主链路上的功能有了一定的理解

所以说从业务架构层面识别主链路是需要基于你的业务场景 还要基于具体的数字 比如转化率等等

综合各方要素 最终定下来的 可不是拍脑袋定下来了

好 我们先总结到这 下一站呢 我们继续来探讨主链路规划三部曲之二同学们 我们下期视频再见





开源笔记

可 Pull Requests 协作写开源笔记

gitee

[https://gitee.com/opendevel/java-for-linux](https://gitee.com/opendevel/java-for-linux)

github

[https://github.com/OSrcD/java-for-linux](https://github.com/OSrcD/java-for-linux)

teambition

[https://tburl.in/0jDNvpbK](https://tburl.in/0jDNvpbK)

开源视频

bilibili

[https://space.bilibili.com/77266754](https://space.bilibili.com/77266754)

开源博客

oschina

[https://my.oschina.net/u/4675154](https://my.oschina.net/u/4675154)

csdn

[https://blog.csdn.net/OpenDevel](https://blog.csdn.net/OpenDevel)

开源项目

gitee

[https://gitee.com/opendevel](https://gitee.com/opendevel)

github

[https://github.com/OSrcD](https://github.com/OSrcD)

开源赞赏

![](https://tcs.teambition.net/storage/3121aed56e96d914e1046f3b498b493ce232?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDQ4NywiaWF0IjoxNjExNDY1Njg3LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjFhZWQ1NmU5NmQ5MTRlMTA0NmYzYjQ5OGI0OTNjZTIzMiJ9.0KxJ-jQePoBogVScqdUZD3aI4wmhBmCT8IfRuc_cL30&download=image.png "")

