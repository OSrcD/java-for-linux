![](https://tcs.teambition.net/storage/3121ce5bafac3412496e5e3ddf31b0875119?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjFjZTViYWZhYzM0MTI0OTZlNWUzZGRmMzFiMDg3NTExOSJ9.BvMy7Xre5fvd7Whp4dTzrt0ahzrwMDPPC5NJtdjop4g&download=image.png "")

![](https://tcs.teambition.net/storage/31218d870e55af766cf287f7813403e360b0?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE4ZDg3MGU1NWFmNzY2Y2YyODdmNzgxMzQwM2UzNjBiMCJ9.EclsmvII5ATFGcDDLvfuHpUrXEfFHXpMv4qvfaVztUE&download=image.png "")

![](https://tcs.teambition.net/storage/3121de9c2374854854e0a295da4f5ff51fb3?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjFkZTljMjM3NDg1NDg1NGUwYTI5NWRhNGY1ZmY1MWZiMyJ9.2duZ_CQbv9cU0Lfqj6ievcACFfmtDxdn9f7247s4EZM&download=image.png "")

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <parent>
        <artifactId>foodie-cloud</artifactId>
        <groupId>com.imooc</groupId>
        <version>1.0-SNAPSHOT</version>
        <relativePath>../../../pom.xml</relativePath>
    </parent>
    <modelVersion>4.0.0</modelVersion>

    <artifactId>foodie-user-service</artifactId>

    <dependencies>
        <dependency>
            <groupId>${project.groupId}</groupId>
            <artifactId>foodie-user-api</artifactId>
            <version>${project.version}</version>
        </dependency>

        <dependency>
            <groupId>${project.groupId}</groupId>
            <artifactId>foodie-user-mapper</artifactId>
            <version>${project.version}</version>
        </dependency>
    </dependencies>

</project>
```

## copy

![](https://tcs.teambition.net/storage/31218768cccf23fb0f3133377d8a258c8d76?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE4NzY4Y2NjZjIzZmIwZjMxMzMzNzdkOGEyNThjOGQ3NiJ9.ItbhaI78EyLjaU8r4Ld4aYhMCgtkJAoZ-zawfTuRvwg&download=image.png "")

![](https://tcs.teambition.net/storage/3121aab8754bf41ab3df88af9dcdfbe173e8?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjFhYWI4NzU0YmY0MWFiM2RmODhhZjlkY2RmYmUxNzNlOCJ9.kQFoW2i7CLhj8oK8QuS9cypzEAXY6rOJAhnz9RyiVvs&download=image.png "")

```java
package com.imooc.user.service.impl;

import com.imooc.enums.YesOrNo;
import com.imooc.user.mapper.UserAddressMapper;
import com.imooc.user.pojo.UserAddress;
import com.imooc.user.pojo.bo.AddressBO;
import com.imooc.user.service.AddressService;
import org.n3r.idworker.Sid;
import org.springframework.beans.BeanUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Propagation;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.web.bind.annotation.RestController;

import java.util.Date;
import java.util.List;

@RestController
public class AddressServiceImpl implements AddressService {

    @Autowired
    private UserAddressMapper userAddressMapper;

    @Autowired
    private Sid sid;


    @Transactional(propagation = Propagation.SUPPORTS)
    @Override
    public List<UserAddress> queryAll(String userId) {

        UserAddress ua = new UserAddress();

        ua.setUserId(userId);

        return userAddressMapper.select(ua);

    }

    @Transactional(propagation = Propagation.REQUIRED)
    @Override
    public void addNewUserAddress(AddressBO addressBO) {

        // 1. 判断当前用户是否存在地址，如果没有，则新增为'默认地址'
        Integer isDefault = 0;
        List<UserAddress> addressList = this.queryAll(addressBO.getUserId());

        if(addressList == null || addressList.isEmpty() || addressList.size() == 0){
            isDefault = 1;
        }

        String addressId = sid.nextShort();

        // 2. 保存地址到数据库
        UserAddress newAddress = new UserAddress();
        BeanUtils.copyProperties(addressBO,newAddress);

        newAddress.setId(addressId);
        newAddress.setIsDefault(isDefault);
        newAddress.setCreatedTime(new Date());
        newAddress.setUpdatedTime(new Date());

        userAddressMapper.insert(newAddress);

    }

    @Transactional(propagation = Propagation.REQUIRED)
    @Override
    public void updateUserAddress(AddressBO addressBO) {
        String addressId = addressBO.getAddressId();

        UserAddress pendingAddress = new UserAddress();
        BeanUtils.copyProperties(addressBO,pendingAddress);

        pendingAddress.setId(addressId);
        pendingAddress.setUpdatedTime(new Date());

        userAddressMapper.updateByPrimaryKeySelective(pendingAddress);
    }

    @Override
    public void deleteUserAddress(String userId, String addressId) {

        UserAddress userAddress = new UserAddress();

        userAddress.setUserId(userId);
        userAddress.setId(addressId);

        userAddressMapper.delete(userAddress);


    }

    @Transactional(propagation = Propagation.REQUIRED)
    @Override
    public void updateUserAddressToBeDefault(String userId, String addressId) {

        // 1. 查找默认地址，设置为不默认
        UserAddress queryAddress = new UserAddress();
        queryAddress.setUserId(userId);
        queryAddress.setIsDefault(YesOrNo.YES.type);
        List<UserAddress> list = userAddressMapper.select(queryAddress);
        for(UserAddress ua : list){
            ua.setIsDefault(YesOrNo.NO.type);
            userAddressMapper.updateByPrimaryKeySelective(ua);
        }

        // 2. 根据地址id修改为默认的地址
        UserAddress defaultAddress = new UserAddress();
        defaultAddress.setId(addressId);
        defaultAddress.setUserId(userId);
        defaultAddress.setIsDefault(YesOrNo.YES.type);

        userAddressMapper.updateByPrimaryKeySelective(defaultAddress);



    }

    @Transactional(propagation = Propagation.SUPPORTS)
    @Override
    public UserAddress queryUserAddress(String userId, String addressId) {

        UserAddress singleAddress = new UserAddress();
        singleAddress.setId(addressId);
        singleAddress.setUserId(userId);

        return userAddressMapper.selectOne(singleAddress);

    }
}

```

```java
package com.imooc.user.service.impl;

import com.imooc.enums.Sex;
import com.imooc.user.mapper.UsersMapper;
import com.imooc.user.pojo.Users;
import com.imooc.user.pojo.bo.UserBO;
import com.imooc.user.service.UserService;
import com.imooc.utils.DateUtil;
import com.imooc.utils.MD5Utils;
import org.n3r.idworker.Sid;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Propagation;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.web.bind.annotation.RestController;
import tk.mybatis.mapper.entity.Example;

import java.util.Date;

@RestController
public class UserServiceImpl implements UserService {

    @Autowired
    private UsersMapper usersMapper;

    @Autowired
    private Sid sid;

    private static final String USER_FACE = "http://122.152.205.72:88/group1/M00/00/05/CpoxxFw_8_qAIlFXAAAcIhVPdSg994.png";

    @Transactional(propagation = Propagation.SUPPORTS)
    @Override
    public boolean queryUsernameIsExist(String username) {

        Example userExample = new Example(Users.class);
        Example.Criteria Usercriteria = userExample.createCriteria();

        Usercriteria.andEqualTo("username", username);

        Users result = usersMapper.selectOneByExample(userExample);
        return result != null;
    }

    @Transactional(propagation = Propagation.REQUIRED)
    @Override
    public Users createUser(UserBO userBO) {

//        try {
//            Thread.sleep(3500);
//        }catch(InterruptedException e){
//            e.printStackTrace();
//        }

        String userId = sid.nextShort();
        Users user = new Users();
        user.setId(userId);
        user.setUsername(userBO.getUsername());
        try {
            user.setPassword(MD5Utils.getMD5Str(userBO.getPassword()));
        } catch (Exception e) {
            e.printStackTrace();
        }
        // 默认用户昵称同用户名
        user.setNickname(userBO.getUsername());
        // 默认头像
        user.setFace(USER_FACE);
        // 默认生日
        user.setBirthday(DateUtil.stringToDate("1900-01-01"));
        // 默认性别为 保密
        user.setSex(Sex.secret.type);

        user.setUpdatedTime(new Date());
        user.setCreatedTime(new Date());

        usersMapper.insert(user);
        return user;
    }

    @Transactional(propagation = Propagation.SUPPORTS)
    @Override
    public Users queryUserForLogin(String username, String password) {

//        try{
//            Thread.sleep(2500);
//        }catch(InterruptedException e){
//            e.printStackTrace();
//        }

        Example userExample = new Example(Users.class);

        Example.Criteria userCriteria = userExample.createCriteria();

        userCriteria.andEqualTo("username", username);
        userCriteria.andEqualTo("password", password);

        Users result = usersMapper.selectOneByExample(userExample);

        return result;
    }
}

```

## copy

![](https://tcs.teambition.net/storage/312152c182a0298da1684e56802d7cbe5106?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE1MmMxODJhMDI5OGRhMTY4NGU1NjgwMmQ3Y2JlNTEwNiJ9.Pr9h3FroNeKVhl2loCwcMl71P0GSAHpjKuhXb7M8tMs&download=image.png "")

![](https://tcs.teambition.net/storage/312113fb5f4ec88a56b3ddb751e6ea447a04?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjExM2ZiNWY0ZWM4OGE1NmIzZGRiNzUxZTZlYTQ0N2EwNCJ9.Un7hbJnKi_lBoKVZNyNQiswr40pj2UoZSOg_hgJGt6A&download=image.png "")

```java
package com.imooc.user.service.impl.center;

import com.imooc.user.mapper.UsersMapper;
import com.imooc.user.pojo.Users;
import com.imooc.user.pojo.bo.center.CenterUserBO;
import com.imooc.user.service.center.CenterUserService;
import org.n3r.idworker.Sid;
import org.springframework.beans.BeanUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.transaction.annotation.Propagation;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.web.bind.annotation.RestController;

import java.util.Date;

@RestController
public class CenterUserServiceImpl implements CenterUserService {

    @Autowired
    private UsersMapper usersMapper;

    @Autowired
    private Sid sid;

    @Transactional(propagation = Propagation.SUPPORTS)
    @Override
    public Users queryUserInfo(String userId) {
        Users user = usersMapper.selectByPrimaryKey(userId);
        user.setPassword(null);
        return user;
    }

    @Transactional(propagation = Propagation.REQUIRED)
    @Override
    public Users updateUserInfo(String userId, CenterUserBO centerUserBO) {

        Users updateUser = new Users();
        BeanUtils.copyProperties(centerUserBO,updateUser);
        updateUser.setId(userId);
        updateUser.setUpdatedTime(new Date());

        usersMapper.updateByPrimaryKeySelective(updateUser);

        return queryUserInfo(userId);
    }

    @Transactional(propagation = Propagation.REQUIRED)
    @Override
    public Users updateUserFaceUrl(String userId, String faceUrl) {

        Users updateUser = new Users();
        updateUser.setId(userId);
        updateUser.setFace(faceUrl);
        updateUser.setUpdatedTime(new Date());

        usersMapper.updateByPrimaryKeySelective(updateUser);

        return queryUserInfo(userId);
    }
}

```

![](https://tcs.teambition.net/storage/312115c198ff99f61fe6464f6a3dfdfb9d76?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjExNWMxOThmZjk5ZjYxZmU2NDY0ZjZhM2RmZGZiOWQ3NiJ9.jwmgKosL9k4ljEdJlJBiT5DkoegU9ai6vixJ6G_aElo&download=image.png "")

![](https://tcs.teambition.net/storage/3121a0d354458698264b0eed56422808d7ff?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjFhMGQzNTQ0NTg2OTgyNjRiMGVlZDU2NDIyODA4ZDdmZiJ9.WEPWPm-JakcaUCKKAwNlmAW8NaKW9Cy_1FegQaF4IFs&download=image.png "")

![](https://tcs.teambition.net/storage/3121d0cfda2299aacbbe1930cdb422df546a?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjFkMGNmZGEyMjk5YWFjYmJlMTkzMGNkYjQyMmRmNTQ2YSJ9.MDCFx2GyVy7rMcREALe59S8Q6cn_h4wz2tGHkYOT6XY&download=image.png "")

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <parent>
        <artifactId>foodie-cloud</artifactId>
        <groupId>com.imooc</groupId>
        <version>1.0-SNAPSHOT</version>
        <relativePath>../../../pom.xml</relativePath>
    </parent>
    <modelVersion>4.0.0</modelVersion>

    <artifactId>foodie-user-web</artifactId>

    <dependencies>
        <dependency>
            <groupId>${project.groupId}</groupId>
            <artifactId>foodie-user-service</artifactId>
            <version>${project.version}</version>
        </dependency>
        <dependency>
            <groupId>${project.groupId}</groupId>
            <artifactId>foodie-cloud-web-components</artifactId>
            <version>${project.version}</version>
        </dependency>

        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
                <configuration>
                    <mainClass>com.imooc.user.UserApplication</mainClass>
                </configuration>
                <executions>
                    <execution>
                        <goals>
                            <goal>repackage</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>

</project>
```

![](https://tcs.teambition.net/storage/3121341b5114600fbcf20c70d960c09ab0a8?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjEzNDFiNTExNDYwMGZiY2YyMGM3MGQ5NjBjMDlhYjBhOCJ9.iytZa-4tavGf2bUDqpIM6ZrWK_ykh1Wns4Uf6Tp0_ls&download=image.png "")

```java
package com.imooc.user;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.client.discovery.EnableDiscoveryClient;
import org.springframework.context.annotation.ComponentScan;
import tk.mybatis.spring.annotation.MapperScan;


@SpringBootApplication
// 扫描 mybatis 通用 mapper 所在的包
@MapperScan(basePackages = "com.imooc.user.mapper")
// 扫描所有包以及相关组件包
@ComponentScan(basePackages = {"com.imooc", "org.n3r.idworker"})
@EnableDiscoveryClient
// TODO feign注解
public class UserApplication {

    public static void main(String[] args) {
        SpringApplication.run(UserApplication.class, args);
    }

}

```

## copy

![](https://tcs.teambition.net/storage/3121cc4c0be96730c0d7f638dbed13e2c15e?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjFjYzRjMGJlOTY3MzBjMGQ3ZjYzOGRiZWQxM2UyYzE1ZSJ9.7YdhS2ygt32_u0N8tiu_2mFqXFZEHTaD20IJViL5qsg&download=image.png "")

## copy

![](https://tcs.teambition.net/storage/31216537d4ea5f84ce0ef0eab7031b1ed00c?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE2NTM3ZDRlYTVmODRjZTBlZjBlYWI3MDMxYjFlZDAwYyJ9.3vftAGpIBCyrpuqcaRe3A7xYH9mmWO1jWh7HkI9eDeY&download=image.png "")

![](https://tcs.teambition.net/storage/312198c1d9f128d257df5bfbae770d02a251?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE5OGMxZDlmMTI4ZDI1N2RmNWJmYmFlNzcwZDAyYTI1MSJ9.iBRXThl1u_zgKoPXnTojFAlZyDI6SyMagC6E2VRpBmk&download=image.png "")

```java
package com.imooc.user.exception;

import com.imooc.pojo.IMOOCJSONResult;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.RestControllerAdvice;
import org.springframework.web.multipart.MaxUploadSizeExceededException;

@RestControllerAdvice
public class CustomExceptionHandler {


    // 上传文件超过500k，捕获异常：MaxUploadSizeExceededException
    @ExceptionHandler(MaxUploadSizeExceededException.class)
    public IMOOCJSONResult handlerMaxUploadFile(MaxUploadSizeExceededException ex) {
        return IMOOCJSONResult.errorMsg("文件上传大小不能超过500k，请压缩图片或者降低图片质量");
    }

}

```

## copy

![](https://tcs.teambition.net/storage/3121d8d46df0663225a8ad069470d357d6ab?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjFkOGQ0NmRmMDY2MzIyNWE4YWQwNjk0NzBkMzU3ZDZhYiJ9.effDEAFL1IMjtb89PEyzz4U30vPzc30w274AJdw5_00&download=image.png "")

## copy

![](https://tcs.teambition.net/storage/3121f491e064fff8bec488f09eca1e2ff2d1?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjFmNDkxZTA2NGZmZjhiZWM0ODhmMDllY2ExZTJmZjJkMSJ9.zbQQi30CzQc5ec2vI8p6NAARBy9cyk7cCR-h4e0Alf4&download=image.png "")

![](https://tcs.teambition.net/storage/3121bca15e9dd671daca751414848872fc05?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjFiY2ExNWU5ZGQ2NzFkYWNhNzUxNDE0ODQ4ODcyZmMwNSJ9.ddXFgAYOQOEA17VEVTUzQaOTpk13JYck5_xEgrBc_ME&download=image.png "")

在passportController

![](https://tcs.teambition.net/storage/3121e955828b761dcd7bd0c37c75314623c1?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjFlOTU1ODI4Yjc2MWRjZDdiZDBjMzdjNzUzMTQ2MjNjMSJ9.tHC_2q6ArFgV4KqThEE7gwpiLtYHCP87aslhw4oA39k&download=image.png "")

在passportController

![](https://tcs.teambition.net/storage/312156dc9ee9529e71180d517e6d8b705c41?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE1NmRjOWVlOTUyOWU3MTE4MGQ1MTdlNmQ4YjcwNWM0MSJ9.06NN-CZtKU51RR95Wee-tK59KUYnxz7no4uobQ7qZC8&download=image.png "")

![](https://tcs.teambition.net/storage/3121aba9539a0ee95a6fa829addb6f469228?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjFhYmE5NTM5YTBlZTk1YTZmYTgyOWFkZGI2ZjQ2OTIyOCJ9.dyJ98VlwwKtlULWfosXYBig8DC3HGpWA4WxNiA228js&download=image.png "")

```java
package com.imooc.user.controller;

import com.imooc.controller.BaseController;
import com.imooc.pojo.IMOOCJSONResult;
import com.imooc.pojo.ShopcartBO;
import com.imooc.user.pojo.Users;
import com.imooc.user.pojo.bo.UserBO;
import com.imooc.user.service.UserService;
import com.imooc.utils.CookieUtils;
import com.imooc.utils.JsonUtils;
import com.imooc.utils.MD5Utils;
import com.imooc.utils.RedisOperator;
import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;
import org.apache.commons.lang3.StringUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.util.ArrayList;
import java.util.List;

@Api(value="注册登录",tags = {"用于注册登录的相关接口"}) // tags是导航的标题 value不知道
@RestController
@RequestMapping("/passport")
public class PassportController extends BaseController {

    @Autowired
    private UserService userService;

    @Autowired
    private RedisOperator redisOperator;

    @ApiOperation(value = "用户名是否存在",notes = "用户名是否存在",httpMethod = "GET") // value是接口名称，可在导航标题下面显示 notes是说明
    @GetMapping("/usernameIsExist")
    public IMOOCJSONResult usernameIsExist(@RequestParam String username) {

        // 1. 判断用户不能为空
        if(StringUtils.isBlank(username)){
            return IMOOCJSONResult.errorMsg("用户名不能为空");
        }

        // 2. 查找用户名是否存在
        boolean isExist = userService.queryUsernameIsExist(username);

        if(isExist){
            return IMOOCJSONResult.errorMsg("用户名已经存在");
        }

        // 3. 请求成功，用户名没有重复
        return IMOOCJSONResult.ok();

    }

    @ApiOperation(value = "用户注册", notes = "用户注册", httpMethod = "POST") // value是接口名称，可在导航标题下面显示 notes是说明
    @PostMapping("/regist")
    public IMOOCJSONResult regist(@RequestBody UserBO userBO,
                                  HttpServletRequest request,
                                  HttpServletResponse response){

        String username = userBO.getUsername();
        String password = userBO.getPassword();
        String confirmPwd = userBO.getConfirmPassword();

        // 0. 判断用户名和密码必须不为空
        if(StringUtils.isBlank(username) ||
                StringUtils.isBlank(password) ||
                StringUtils.isBlank(confirmPwd)){

            return IMOOCJSONResult.errorMsg("用户名或密码不能为空");
        }
        // 1. 查询用户名是否存在
        boolean isExist = userService.queryUsernameIsExist(username);
        if(isExist){
            return IMOOCJSONResult.errorMsg("用户名已经存在");
        }

        // 2. 密码长度不能少于6位
        if(password.length() < 6){
            return IMOOCJSONResult.errorMsg("密码长度不能少于6");
        }

        // 3. 判断两次密码是否一致
        if(!password.equals(confirmPwd)){
            return IMOOCJSONResult.errorMsg("两次密码输入不一致");
        }

        // 4.实现注册
        Users userResult = userService.createUser(userBO);

        userResult = setNullProperty(userResult);

        // 实现用户的redis会话
//        UsersVO usersVO = conventUsersVO(userResult);

        CookieUtils.setCookie(request, response, "user",
                JsonUtils.objectToJson(userResult), true);

        // 同步购物车数据
        synchShopcartData(userResult.getId(), request, response);

        return IMOOCJSONResult.ok();

    }



    @ApiOperation(value="用户登录",notes="用户登录",httpMethod="POST")
    @PostMapping("/login")
    public IMOOCJSONResult login(@RequestBody UserBO userBO,
                                 HttpServletRequest request,
                                 HttpServletResponse response) throws Exception{

        String username = userBO.getUsername();
        String password = userBO.getPassword();


        // 0. 判断用户名和密码必须不为空
        if(StringUtils.isEmpty(username)
                || StringUtils.isEmpty(password)){
            return IMOOCJSONResult.errorMsg("用户名或密码不能为空");
        }

        // 1.实现登录
        Users userResult = userService.queryUserForLogin(username,
                MD5Utils.getMD5Str(password));

        if(userResult == null){
            return IMOOCJSONResult.errorMsg("用户名或密码不正确");
        }

        userResult = setNullProperty(userResult);

        // 实现用户的redis会话
//        UsersVO usersVO = conventUsersVO(userResult);

        CookieUtils.setCookie(request,response,"user",
                JsonUtils.objectToJson(userResult),true);

        // 同步购物车数据
        synchShopcartData(userResult.getId(), request, response);


        return IMOOCJSONResult.ok(userResult);

    }


    private void synchShopcartData(String userId,HttpServletRequest request,HttpServletResponse response){
        /**
         * 1. redis中无数据，如果cookie中的购物车为空，那么这个时候不做任何处理
         *                 如果cookie中的购物车不为空，此时直接放入redis中
         * 2. redis中有数据，如果cookie中的购物车为空，那么直接把redis的购物车覆盖本地cookie
         *                 如果cookie中的购物车不为空，
         *                      如果cookie中的某个商品在redis存在,
         *                      则以cookie为主，删除redis中的，
         *                      把cookie中的商品直接覆盖redis中（参考京东）
         * 3. 同步到redis中去了以后，覆盖本地cookie购物车数据，保证本地购物车的数据是同步最新的
         */

        // 从redis中获取购物车
        String shopcartJsonRedis = redisOperator.get(FOODIE_SHOPCART + ":" + userId);

        // 从cookie中获取购物车
        String shopcartStrCookie = CookieUtils.getCookieValue(request,FOODIE_SHOPCART,true);

        if (StringUtils.isBlank(shopcartJsonRedis)) {

            // redis为空，cookie不为空，直接把cookie中的数据放入redis
            if (StringUtils.isNotBlank(shopcartStrCookie)) {
                redisOperator.set(FOODIE_SHOPCART + ":" + userId, shopcartStrCookie);
            }

        }else{
            // redis不为空，cookie不为空,合并cookie和redis中购物车的商品数据（同一商品则覆盖redis）
            if (StringUtils.isNotBlank(shopcartStrCookie)) {

                /**
                 * 1. 已经存在的，把cookie中对应的数量，覆盖redis（参考京东）
                 * 2. 该项商品标记为待删除，统一放入一个待删除的list
                 * 3. 从cookie中清理所有的待删除list
                 * 4. 合并redis和cookie中的数据
                 * 5. 更新到redis和cookie中
                 */

                List<ShopcartBO> shopcartListRedis = JsonUtils.jsonToList(shopcartJsonRedis, ShopcartBO.class);
                List<ShopcartBO> shopcartListCookie = JsonUtils.jsonToList(shopcartStrCookie, ShopcartBO.class);

                // 定义一个待删除list
                List<ShopcartBO> pendingDeleteList = new ArrayList<>();

                for (ShopcartBO redisShopcart : shopcartListRedis) {

                    String redisSpecId = redisShopcart.getSpecId();

                    for (ShopcartBO cookieShopcart : shopcartListCookie) {
                        String cookieSpecId = cookieShopcart.getSpecId();

                        if (redisSpecId.equals(cookieSpecId)) {
                            // 覆盖购买数量，不累加，参考京东
                            redisShopcart.setBuyCounts(cookieShopcart.getBuyCounts());
                            // 把cookieShopcar放入待删除列表，用于最后的删除与合并
                            pendingDeleteList.add(cookieShopcart);
                        }

                    }
                }

                // 从现有cookie中删除对应覆盖过的商品数据
                shopcartListCookie.removeAll(pendingDeleteList);

                // 合并两个list
                shopcartListRedis.addAll(shopcartListCookie);

                // 更新到redis和cookie
                CookieUtils.setCookie(request, response, FOODIE_SHOPCART, JsonUtils.objectToJson(shopcartListRedis), true);
                redisOperator.set(FOODIE_SHOPCART + ":" + userId, JsonUtils.objectToJson(shopcartListRedis));


            }else{
                // redis不为空，cookie为空，直接把redis覆盖cookie
                CookieUtils.setCookie(request, response, FOODIE_SHOPCART, shopcartJsonRedis,true);
            }
        }

    }

    /**
     * 设置密码、手机、邮件、创建时间、更新时间、生日为空
     */

    public Users setNullProperty(Users userResult){
        userResult.setPassword(null);
        userResult.setMobile(null);
        userResult.setEmail(null);
        userResult.setCreatedTime(null);
        userResult.setUpdatedTime(null);
        userResult.setBirthday(null);
        return userResult;
    }

    @ApiOperation(value = "退出登录",notes = "退出登录",httpMethod = "POST")
    @PostMapping("/logout")
    public IMOOCJSONResult logout(@RequestParam String userId,
                                  HttpServletRequest request,
                                  HttpServletResponse response){

        // 清除用户的相关信息的cookie
        CookieUtils.deleteCookie(request,response,"user");


        // 用户退出登录，清除redis中user的会话信息
        redisOperator.del(REDIS_USER_TOKEN + ":" + userId);

        // 分布式会话中需要清理用户数据
        CookieUtils.deleteCookie(request, response, FOODIE_SHOPCART);

        return IMOOCJSONResult.ok();

    }


}

```

![](https://tcs.teambition.net/storage/312158b9de992fc1b0833e0acfa190a20d43?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE1OGI5ZGU5OTJmYzFiMDgzM2UwYWNmYTE5MGEyMGQ0MyJ9.vlFCRNwJh1d1cl_A-RFbdniScz4o9PomxmWi2nCp5TM&download=image.png "")

```java
package com.imooc.user.controller;

import com.imooc.user.pojo.UserAddress;
import com.imooc.user.pojo.bo.AddressBO;
import com.imooc.user.service.AddressService;
import com.imooc.pojo.IMOOCJSONResult;
import com.imooc.utils.MobileEmailUtils;
import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;
import org.apache.commons.lang3.StringUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@Api(value="地址相关",tags={"地址相关的api接口"})
@RequestMapping("address")
@RestController
public class AddressController {


    /**
     * 用户在确认订单页面，可以针对收货地址做如下操作：
     * 1. 查询用户的所有收货地址列表
     * 2. 新增收货地址
     * 3. 删除收货地址
     * 4. 修改收货地址
     * 5. 设置默认地址
     */

    @Autowired
    private AddressService addressService;


    @ApiOperation(value="根据用户id查询收货地址列表",notes="根据用户id查询收货地址列表",httpMethod="POST")
    @PostMapping("/list")
    public IMOOCJSONResult list(
            @RequestParam String userId){

        if(StringUtils.isBlank(userId)){
            return IMOOCJSONResult.errorMsg("");
        }

        List<UserAddress> list = addressService.queryAll(userId);
        return IMOOCJSONResult.ok(list);
    }

    @ApiOperation(value="用户新增地址",notes="用户新增地址",httpMethod="POST")
    @PostMapping("/add")
    public IMOOCJSONResult add(@RequestBody AddressBO addressBO){

        IMOOCJSONResult checkRes = checkAddress(addressBO);
        if(checkRes.getStatus() != 200){
            return checkRes;
        }

        addressService.addNewUserAddress(addressBO);

        return IMOOCJSONResult.ok();
    }

    @ApiOperation(value="用户修改地址",notes="用户修改地址",httpMethod="POST")
    @PostMapping("/update")
    public IMOOCJSONResult update(@RequestBody AddressBO addressBO){

        if(StringUtils.isBlank(addressBO.getAddressId())){
            return IMOOCJSONResult.errorMsg("修改地址错误：addressId不能为空");
        }

        IMOOCJSONResult checkRes = checkAddress(addressBO);
        if(checkRes.getStatus() != 200){
            return checkRes;
        }

        addressService.updateUserAddress(addressBO);

        return IMOOCJSONResult.ok();
    }


    private IMOOCJSONResult checkAddress(AddressBO addressBO) {
        String receiver = addressBO.getReceiver();
        if (StringUtils.isBlank(receiver)) {
            return IMOOCJSONResult.errorMsg("收货人不能为空");
        }
        if (receiver.length() > 12) {
            return IMOOCJSONResult.errorMsg("收货人姓名不能太长");
        }

        String mobile = addressBO.getMobile();
        if (StringUtils.isBlank(mobile)) {
            return IMOOCJSONResult.errorMsg("收货人手机号不能为空");
        }
        if (mobile.length() != 11) {
            return IMOOCJSONResult.errorMsg("收货人手机号长度不正确");
        }
        boolean isMobileOk = MobileEmailUtils.checkMobileIsOk(mobile);
        if (!isMobileOk) {
            return IMOOCJSONResult.errorMsg("收货人手机号格式不正确");
        }

        String province = addressBO.getProvince();
        String city = addressBO.getCity();
        String district = addressBO.getDistrict();
        String detail = addressBO.getDetail();
        if (StringUtils.isBlank(province) ||
                StringUtils.isBlank(city) ||
                StringUtils.isBlank(district) ||
                StringUtils.isBlank(detail)) {
            return IMOOCJSONResult.errorMsg("收货地址信息不能为空");
        }

        return IMOOCJSONResult.ok();
    }


    @ApiOperation(value="用户删除地址",notes="用户删除地址",httpMethod="POST")
    @PostMapping("/delete")
    public IMOOCJSONResult delete(
            @RequestParam String userId,
            @RequestParam String addressId){

        if(StringUtils.isBlank(userId) || StringUtils.isBlank(addressId)){
            return IMOOCJSONResult.errorMsg("");
        }

        addressService.deleteUserAddress(userId,addressId);
        return  IMOOCJSONResult.ok();

    }


    @ApiOperation(value="用户设置默认地址",notes="用户设置默认地址",httpMethod="POST")
    @PostMapping("/setDefalut")
    public IMOOCJSONResult setDefalut(
            @RequestParam String userId,
            @RequestParam String addressId){

        if(StringUtils.isBlank(userId) || StringUtils.isBlank(addressId)){
            return IMOOCJSONResult.errorMsg("");
        }

        addressService.updateUserAddressToBeDefault(userId,addressId);
        return IMOOCJSONResult.ok();
    }

}

```

## copy

![](https://tcs.teambition.net/storage/3121b81a0595c6e137f49f8ad8934f89e361?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjFiODFhMDU5NWM2ZTEzN2Y0OWY4YWQ4OTM0Zjg5ZTM2MSJ9.ZYpFgOKANA7ayS48ffqxmSiEDoTWB7SxSHggJ6P92Uo&download=image.png "")

![](https://tcs.teambition.net/storage/31216f1371a901465f1c02027e625631dbc2?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE2ZjEzNzFhOTAxNDY1ZjFjMDIwMjdlNjI1NjMxZGJjMiJ9.jKVOFBvyVNWWvW_Jhw24mA3JcJ4eb9HffTsiYrxzQqE&download=image.png "")

```java
package com.imooc.user.center;


import com.imooc.user.pojo.Users;
import com.imooc.user.service.center.CenterUserService;
import com.imooc.pojo.IMOOCJSONResult;
import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;
import io.swagger.annotations.ApiParam;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

@Api(value="center - 用户中心",tags={"用户中心展示的相关接口"})
@RestController
@RequestMapping("center")
public class CenterController {

    @Autowired
    private CenterUserService centerUserService;

    @ApiOperation(value="获取用户信息",notes="获取用户信息",httpMethod="GET")
    @GetMapping("/userInfo")
    public IMOOCJSONResult userInfo(
            @ApiParam(name="userId",value="用户id",required=true)
            @RequestParam String userId){

        Users user = centerUserService.queryUserInfo(userId);
        return IMOOCJSONResult.ok(user);
    }



}

```

![](https://tcs.teambition.net/storage/312196bc8c6f8ec5e29fd5fab41f6fadb880?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE5NmJjOGM2ZjhlYzVlMjlmZDVmYWI0MWY2ZmFkYjg4MCJ9.8nAEd5lTlQ_P4o4cpgHn3cQAbrQ1YfosXqm8vxXRFP4&download=image.png "")

```java
package com.imooc.user.center;

import com.imooc.controller.BaseController;
import com.imooc.user.pojo.Users;
import com.imooc.user.pojo.bo.center.CenterUserBO;
import com.imooc.user.resource.FileUpload;
import com.imooc.user.service.center.CenterUserService;
import com.imooc.utils.CookieUtils;
import com.imooc.utils.DateUtil;
import com.imooc.pojo.IMOOCJSONResult;
import com.imooc.utils.JsonUtils;
import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;
import io.swagger.annotations.ApiParam;
import org.apache.commons.io.IOUtils;
import org.apache.commons.lang3.StringUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.validation.BindingResult;
import org.springframework.validation.FieldError;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.multipart.MultipartFile;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.validation.Valid;
import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

@Api(value = "用户信息接口", tags = {"用户信息相关接口"})
@RestController
@RequestMapping("userInfo")
public class CenterUserController extends BaseController {


    @Autowired
    private CenterUserService centerUserService;

    @Autowired
    private FileUpload fileUpload;




    @ApiOperation(value = "用户头像修改", notes = "用户头像修改", httpMethod = "POST")
    @PostMapping("/uploadFace")
    public IMOOCJSONResult uploadFace(
            @ApiParam(name = "userId", value = "用户id", required = true)
            @RequestParam String userId,
            @ApiParam(name = "file", value = "用户头像", required = true)
            @RequestParam MultipartFile file,
            HttpServletRequest request, HttpServletResponse response) {

        // 定义头像保存的地址
//        String fileSpace = IMAGE_USER_FACE_LOCATION;
        String fileSpace = fileUpload.getImageUserFaceLocation(); // /Users/virtualman/Downloads/temp/workspace/images/foodie/faces



        // 在路径上为每一个用户增加一个userId，用于区分不同用户上传
        String uploadPathPrefix = File.separator + userId; //  / 201013ASBYNDSR1P

        // 开发文件上传
        if (file != null) {
            FileOutputStream fileOutputStream = null;
            InputStream inputStream = null;
            try {

                // 获得文件上传的文件名称
                String fileName = file.getOriginalFilename(); // xxx.png xxx.jpg xxx.jpeg

                if (StringUtils.isNotBlank(fileName)) {


                    // 文件重命名 imooc-face.png -> ["imooc-face","png"]
                    String[] fileNameArr = fileName.split("\\.");


                    // 获得文件的后缀名
                    String suffix = fileNameArr[fileNameArr.length - 1]; // png jpe jpeg

                    if (!suffix.equalsIgnoreCase("png") &&
                            !suffix.equalsIgnoreCase("jpg") &&
                            !suffix.equalsIgnoreCase("jpeg")) {

                        return IMOOCJSONResult.errorMsg("图片格式不正确！");

                    }


                    // face-{userId}.png
                    // 文件名称重组 覆盖式上传，增量式: 额外拼接当前时间
                    String newFileName = "face-" + userId + "." + suffix; // face- 201013ASBYNDSR1P . png

                    /**
                     * 上传文件头像最终保存位置
                     * /Users/virtualman/Downloads/temp/workspace/images/foodie/faces /201013ASBYNDSR1P / face-201013ASBYNDSR1P.png
                     */
                    String finalFilePath = fileSpace + uploadPathPrefix + File.separator + newFileName;
                    // 用于提供给web服务访问的地址
                    uploadPathPrefix += ( "/" + newFileName); // /201013ASBYNDSR1P / face-201013ASBYNDSR1P.png




                    // /Users/virtualman/Downloads/temp/workspace/images/foodie/faces /201013ASBYNDSR1P / face-201013ASBYNDSR1P.png
                    File outFile = new File(finalFilePath);

                    if (outFile.getParentFile() != null) { // 只要存在相应的父类目录

                        /**
                         * 创建文件夹
                         * 在/Users/virtualman/Downloads/temp/workspace/images/foodie/faces创建下面目录
                         * /201013ASBYNDSR1P
                         */
                        outFile.getParentFile().mkdirs();
                    }


                    /**
                     * 文件输出保存到目录
                     * /Users/virtualman/Downloads/temp/workspace/images/foodie/faces/201013ASBYNDSR1P/face-201013ASBYNDSR1P.png
                     */
                    fileOutputStream = new FileOutputStream(outFile);
                    inputStream = file.getInputStream();
                    IOUtils.copy(inputStream, fileOutputStream); // 当两个流连接在一起就形成了pipeline

                }
            } catch (IOException e) {
                e.printStackTrace();
            }finally{
                if (fileOutputStream != null) {
                    try {
                        fileOutputStream.flush();
                        fileOutputStream.close(); // 防止内存泄露
                    } catch (IOException e) {
                        e.printStackTrace();
                    }
                }
            }

        } else {
            return IMOOCJSONResult.errorMsg("文件不能为空!");
        }

        // 获取图片服务地址
        String imageServerUrl = fileUpload.getImageServerUrl(); // http://localhost:8088/foodie/faces

        /**
         * 由于浏览器可能存在缓存情况，所以在这里，我们需要加上时间戳来保证更新后的图片可以及时刷新
         * http://localhost:8088/foodie/faces /201013ASBYNDSR1P?t= 20201021122213
         */
        String finalUserFaceUrl = imageServerUrl + uploadPathPrefix +
                "?t=" + DateUtil.getCurrentDateString(DateUtil.DATE_PATTERN);

        // 更新用户头像到数据库
        Users userResult = centerUserService.updateUserFaceUrl(userId,finalUserFaceUrl); // http://localhost:8088/foodie/faces/201013ASBYNDSR1P?t=20201021122213

//        UsersVO usersVO = conventUsersVO(userResult);

        userResult = setNullProperty(userResult);
        CookieUtils.setCookie(request, response, "user",
                JsonUtils.objectToJson(userResult), true);

        return IMOOCJSONResult.ok();


    }


    @ApiOperation(value = "修改用户信息", notes = "修改用户信息", httpMethod = "POST")
    @PostMapping("/update")
    public IMOOCJSONResult update(
            @ApiParam(name = "userId", value = "用户Id", required = true)
            @RequestParam String userId,
            @RequestBody @Valid CenterUserBO centerUserBO,
            BindingResult result,
            HttpServletRequest request, HttpServletResponse response) {

        // 判断BindingResult是否保存错误的验证信息，如果有，则直接return
        if (result.hasErrors()) {
            Map<String, String> errors = getErrors(result);
            return IMOOCJSONResult.errorMap(errors);
        }

        Users userResult = centerUserService.updateUserInfo(userId, centerUserBO);

        // 增加令牌token，会整合进redis，分布式会话
//        UsersVO usersVO = conventUsersVO(userResult);

        userResult = setNullProperty(userResult);
        CookieUtils.setCookie(request, response, "user",
                JsonUtils.objectToJson(userResult), true);

        return IMOOCJSONResult.ok();
    }

    private Users setNullProperty(Users userResult) {
        userResult.setPassword(null);
        userResult.setMobile(null);
        userResult.setEmail(null);
        userResult.setCreatedTime(null);
        userResult.setUpdatedTime(null);
        userResult.setBirthday(null);
        return userResult;
    }


    private Map<String, String> getErrors(BindingResult result) {
        Map<String, String> map = new HashMap<>();
        List<FieldError> errorList = result.getFieldErrors();
        for (FieldError error : errorList) {
            // 发生验证错误所对应的某一个属性
            String errorField = error.getField();
            // 验证错误信息
            String errorMsg = error.getDefaultMessage();

            map.put(errorField, errorMsg);
        }
        return map;

    }

}

```

## 复制

![](https://tcs.teambition.net/storage/312165b54ed2496ac772ca0a073ee57b89c9?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE2NWI1NGVkMjQ5NmFjNzcyY2EwYTA3M2VlNTdiODljOSJ9.yGAc9hl1i3TQcSJtf4ehcTtDS6IM9rawCgML2InUcps&download=image.png "")

![](https://tcs.teambition.net/storage/312179ad7b48fdfb605bf39f5ff87a0d2975?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE3OWFkN2I0OGZkZmI2MDViZjM5ZjVmZjg3YTBkMjk3NSJ9.Icu1uEhJ1GiKm6GqVx73Mmf-XhWPumqrmsFJbuQl05s&download=image.png "")

```yaml
############################################################
#
# web访问端口号  约定：8088
#
############################################################
server:
#  port: 8088
  tomcat:
    uri-encoding: UTF-8
  max-http-header-size: 80KB

############################################################
#
# 配置数据源信息
# !!! 更改application name
#
############################################################
spring:
  application:
    name: foodie-user-service # 微服务在注册中心的名字
  profiles:
    active: dev
  datasource:                                           # 数据源的相关配置
    type: com.zaxxer.hikari.HikariDataSource          # 数据源类型：HikariCP
    driver-class-name: com.mysql.jdbc.Driver          # mysql驱动
#    url: jdbc:mysql://localhost:3306/foodie-shop-dev?useUnicode=true&characterEncoding=UTF-8&autoReconnect=true
    username: root
#    password: opendevel
    hikari:
      connection-timeout: 30000       # 等待连接池分配连接的最大时长（毫秒），超过这个时长还没可用的连接则发生SQLException， 默认:30秒
      minimum-idle: 5                 # 最小连接数
      maximum-pool-size: 20           # 最大连接数
      auto-commit: true               # 自动提交
      idle-timeout: 600000            # 连接超时的最大时长（毫秒），超时则被释放（retired），默认:10分钟
      pool-name: DateSourceHikariCP   # 连接池名字
      max-lifetime: 1800000           # 连接的生命时长（毫秒），超时而且没被使用则被释放（retired），默认:30分钟 1800000ms
      connection-test-query: SELECT 1
  servlet:
    multipart:
      max-file-size: 512000      # 文件上传大小限制为500kb
      max-request-size: 512000  # 请求大小限制为500kb
#  session:
#    store-type: redis
############################################################
#
# mybatis 配置
# !!! 更改路径
#
############################################################
mybatis:
  type-aliases-package: com.imooc.user.pojo          # 所有POJO类所在包路径
  mapper-locations: classpath:mapper/*.xml      # mapper映射文件
#  configuration:
#    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
############################################################
#
# mybatis mapper 配置
#
############################################################
# 通用 Mapper 配置
mapper:
  mappers: com.imooc.my.mapper.MyMapper
  not-empty: false    # 在进行数据库操作的的时候，判断表达式 username != null, 是否追加 username != ''
  identity: MYSQL

# 分页插件配置
pagehelper:
  helperDialect: mysql
  supportMethodsArguments: true



#  resources:
#    static-locations: classpath:/static



```

![](https://tcs.teambition.net/storage/3121e4f8f13eef2d7353ab390e9d9a8c0b0b?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjFlNGY4ZjEzZWVmMmQ3MzUzYWIzOTBlOWQ5YThjMGIwYiJ9.bj1ttE5lUiP9jX0dQjpAyIA2z2barYGohs7gz3f8OqQ&download=image.png "")

```yaml
server:
  port: 10002

spring:
  datasource:                                           # 数据源的相关配置
    # 拆分数据源到独立database instance，或者独立schema
#    url: jdbc:mysql://localhost:3306/foodie-cloud-item?useUnicode=true&characterEncoding=UTF-8&autoReconnect=true
    url: jdbc:mysql://localhost:3306/foodie-shop-dev?useUnicode=true&characterEncoding=UTF-8&autoReconnect=true
    password: opendevel
  redis:
    # Redis 单机单实例
    database: 0
    host: localhost
#    host: 192.168.245.138
    port: 6379
    password: imooc
    # Redis 哨兵模式
#    database: 1
#    password: imooc
#    sentinel:
#      master: imooc-master
#      nodes: 192.168.245.138:26379,192.168.245.139:26379,192.168.245.140:26379
#    password: imooc
#    cluster:
#      nodes: 192.168.245.141:6379,192.168.245.142:6379,192.168.245.143:6379,192.168.245.144:6379,192.168.245.145:6379,192.168.245.146:6379

mybatis:
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl


```

## 复制

![](https://tcs.teambition.net/storage/31210cfdb82aa34acf952d5a8df1b118c9b4?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjEwY2ZkYjgyYWEzNGFjZjk1MmQ1YThkZjFiMTE4YzliNCJ9.9OD_bghXwgDplTI1rhtf47YWn-PGza1wMfQLX5VrRgs&download=image.png "")

![](https://tcs.teambition.net/storage/3121e76b8ee83f9deb9752015d8be6857894?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjFlNzZiOGVlODNmOWRlYjk3NTIwMTVkOGJlNjg1Nzg5NCJ9.LCfQejCvqX1mwsHxDm8M7IvaBNC-aN3z4MndFsN618o&download=image.png "")

```text
file.ImageUserFaceLocation=/Users/virtualman/Downloads/temp/workspace/images/foodie/faces

#TODO 改端口
file.ImageServerUrl=http://localhost:8088/foodie/faces
```

![](https://tcs.teambition.net/storage/31215adb9c53a2c5823b55d8be1e225dbdba?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE1YWRiOWM1M2EyYzU4MjNiNTVkOGJlMWUyMjVkYmRiYSJ9.JO-mZTYUjtk9TdHuGyB6D4PjRuB_9huvtdPaBYXkOMA&download=image.png "")

```yaml
server:
  port: 10002

spring:
  datasource:                                           # 数据源的相关配置
    # 拆分数据源到独立database instance，或者独立schema
#    url: jdbc:mysql://localhost:3306/foodie-cloud-item?useUnicode=true&characterEncoding=UTF-8&autoReconnect=true
    url: jdbc:mysql://localhost:3306/foodie-shop-dev?useUnicode=true&characterEncoding=UTF-8&autoReconnect=true
    password: opendevel
  redis:
    # Redis 单机单实例
    database: 0
#    host: localhost
    host: 192.168.245.138
    port: 6379
    password: imooc
    # Redis 哨兵模式
#    database: 1
#    password: imooc
#    sentinel:
#      master: imooc-master
#      nodes: 192.168.245.138:26379,192.168.245.139:26379,192.168.245.140:26379
#    password: imooc
#    cluster:
#      nodes: 192.168.245.141:6379,192.168.245.142:6379,192.168.245.143:6379,192.168.245.144:6379,192.168.245.145:6379,192.168.245.146:6379

mybatis:
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl


```

## 启动注册中心

## 启动Redis

![](https://tcs.teambition.net/storage/31211522630a008ffad1eb7d02e3b6309835?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjExNTIyNjMwYTAwOGZmYWQxZWI3ZDAyZTNiNjMwOTgzNSJ9.HVHhFHiQxOnLRps1dEUee-5mPCrLif1RwATrObnBGec&download=image.png "")

![](https://tcs.teambition.net/storage/312177b27275987014110ff2313f304c0b4a?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE3N2IyNzI3NTk4NzAxNDExMGZmMjMxM2YzMDRjMGI0YSJ9.AFIDuDYVMDJU2ahSftSQryBExOHXqRR8KlBOIZKP8AA&download=image.png "")

![](https://tcs.teambition.net/storage/312165652481c3f87b39076f5e566f3d4139?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE2NTY1MjQ4MWMzZjg3YjM5MDc2ZjVlNTY2ZjNkNDEzOSJ9.WQ-vq7zOvYH14rXZlivDM204yuMYZM5nMoloQzD5NAw&download=image.png "")

![](https://tcs.teambition.net/storage/31212e550b971dbed6d41fc0c67d300ac9ac?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjEyZTU1MGI5NzFkYmVkNmQ0MWZjMGM2N2QzMDBhYzlhYyJ9.RATgi_6QFLUF6p-VupGsid1SNrbgR4HRYZBeNmy5Ygs&download=image.png "")

## 主链路接口返回时间要求 希望在100ms以内

## 最多超时时间控制在1000ms

![](https://tcs.teambition.net/storage/3121ad2c8d1f009052da59e6db680596775d?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjFhZDJjOGQxZjAwOTA1MmRhNTllNmRiNjgwNTk2Nzc1ZCJ9.9xsbDODu9ujoZv8WWaudRN1deMyq2TqapjCrYDQ4Kos&download=image.png "")

![](https://tcs.teambition.net/storage/312150142227499da9dbebb6c630b032e2ad?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE1MDE0MjIyNzQ5OWRhOWRiZWJiNmM2MzBiMDMyZTJhZCJ9.e2JY9Gzi1WJmx49H99D7C3vEKlNp_n0sQsDC-qhqrkE&download=image.png "")



开源笔记

可 Pull Requests 协作写开源笔记

gitee

[https://gitee.com/opendevel/java-for-linux](https://gitee.com/opendevel/java-for-linux)

github

[https://github.com/OSrcD/java-for-linux](https://github.com/OSrcD/java-for-linux)

teambition

[https://tburl.in/0jDNvpbK](https://tburl.in/0jDNvpbK)

开源视频

bilibili

[https://space.bilibili.com/77266754](https://space.bilibili.com/77266754)

开源博客

oschina

[https://my.oschina.net/u/4675154](https://my.oschina.net/u/4675154)

csdn

[https://blog.csdn.net/OpenDevel](https://blog.csdn.net/OpenDevel)

开源项目

gitee

[https://gitee.com/opendevel](https://gitee.com/opendevel)

github

[https://github.com/OSrcD](https://github.com/OSrcD)

开源赞赏

![](https://tcs.teambition.net/storage/3121aed56e96d914e1046f3b498b493ce232?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NjM5NSwiaWF0IjoxNjEyMTkxNTk1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjFhZWQ1NmU5NmQ5MTRlMTA0NmYzYjQ5OGI0OTNjZTIzMiJ9.A9uA2GQiqUztWyv0KNqeagm0vVH2v43jSU5fdi94Ecc&download=image.png "")

