![](https://tcs.teambition.net/storage/3122a4346246fee76ec549740a65317b429f?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NTA3MywiaWF0IjoxNjEyMTkwMjczLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjJhNDM0NjI0NmZlZTc2ZWM1NDk3NDBhNjUzMTdiNDI5ZiJ9.Ci1CZ1zA8PzQ6V4sPidsHygH-eXuQ7aF_SE9s-MQcpI&download=image.png "")

![](https://tcs.teambition.net/storage/31229c57ed5e92e0dd536d44541d54683da6?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NTA3MywiaWF0IjoxNjEyMTkwMjczLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjI5YzU3ZWQ1ZTkyZTBkZDUzNmQ0NDU0MWQ1NDY4M2RhNiJ9._d5jvy6p3OznnwF_Yn-KKSehz9z2H3W-LmoLgkDjiQg&download=image.png "")

![](https://tcs.teambition.net/storage/3122a9c8fa27c51124dd7b8310be937e7aac?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NTA3MywiaWF0IjoxNjEyMTkwMjczLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjJhOWM4ZmEyN2M1MTEyNGRkN2I4MzEwYmU5MzdlN2FhYyJ9.lLjD2D1CqBHuvkVjiVCYmwP-Xlk3md1MWUjgefZ-PMk&download=image.png "")

![](https://tcs.teambition.net/storage/3122a064f3843072b89ecf332e3bed09b27a?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NTA3MywiaWF0IjoxNjEyMTkwMjczLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjJhMDY0ZjM4NDMwNzJiODllY2YzMzJlM2JlZDA5YjI3YSJ9.Qhn_6CtM1VOQinfrtnh8cvv4laVSXWAXfDE3zg1Sirk&download=image.png "")

![](https://tcs.teambition.net/storage/3122921adf083178aa7b7730848450d14029?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NTA3MywiaWF0IjoxNjEyMTkwMjczLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjI5MjFhZGYwODMxNzhhYTdiNzczMDg0ODQ1MGQxNDAyOSJ9.mVri3BK8sQKD7AitjrxEIPyn5HH0Mq9KZrPAnwEch7w&download=image.png "")

![](https://tcs.teambition.net/storage/3122a1efdbd84e3ce91fb7c0abbf9471e769?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NTA3MywiaWF0IjoxNjEyMTkwMjczLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjJhMWVmZGJkODRlM2NlOTFmYjdjMGFiYmY5NDcxZTc2OSJ9.VAbINmTT2vNqCbbCgobMIc3DBkX7PYXm1bZi3mj_wb8&download=image.png "")

![](https://tcs.teambition.net/storage/31229ccdee50a9a5f190f7b2b4ed88fc9a87?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NTA3MywiaWF0IjoxNjEyMTkwMjczLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjI5Y2NkZWU1MGE5YTVmMTkwZjdiMmI0ZWQ4OGZjOWE4NyJ9.8N533DLQHFzEBP1uA5ENuAPWSbaCGo5N5jdAHWRI-2s&download=image.png "")

理论上这个插件不需要重启的

![](https://tcs.teambition.net/storage/3122a03e2dc0d9a9b75cc4e2ccab3702ffa7?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NTA3MywiaWF0IjoxNjEyMTkwMjczLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjJhMDNlMmRjMGQ5YTliNzVjYzRlMmNjYWIzNzAyZmZhNyJ9.P_cDhbi4uiG-5rGbs6kzWzYKdFHaZneHPgppUVwO4s8&download=image.png "")

![](https://tcs.teambition.net/storage/31229f637eead17a91ed58386d471a9b1d59?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NTA3MywiaWF0IjoxNjEyMTkwMjczLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjI5ZjYzN2VlYWQxN2E5MWVkNTgzODZkNDcxYTliMWQ1OSJ9.8lXPATpqkX-P-XW7egCt_zplu1-mYYvuGzKIg72j8tc&download=image.png "")

![](https://tcs.teambition.net/storage/31228dc389b033ddbaf1c3dc2ba0eda0ae7a?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NTA3MywiaWF0IjoxNjEyMTkwMjczLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjI4ZGMzODliMDMzZGRiYWYxYzNkYzJiYTBlZGEwYWU3YSJ9.aVNSxl14FjIzThK7PogyXxJ-YZ4K-wsqKa3C_6Y07C4&download=image.png "")

![](https://tcs.teambition.net/storage/3122f5e67d9be4aee4062ec0834b18df9073?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NTA3MywiaWF0IjoxNjEyMTkwMjczLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjJmNWU2N2Q5YmU0YWVlNDA2MmVjMDgzNGIxOGRmOTA3MyJ9.I2rDpppeyuyurMc-nAHZNnP_8IvDC5UIEsfTb7RJ1Rg&download=image.png "")

![](https://tcs.teambition.net/storage/31220253fc0390a07f418e23c587172daf70?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NTA3MywiaWF0IjoxNjEyMTkwMjczLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjIwMjUzZmMwMzkwYTA3ZjQxOGUyM2M1ODcxNzJkYWY3MCJ9.r-OSZsPHFingpAr_yBRMyZ-595_cQ0yWsMHbauDxC3g&download=image.png "")

```java
package com.imooc.springcloud.topic;

import org.springframework.cloud.stream.annotation.Input;
import org.springframework.cloud.stream.annotation.Output;
import org.springframework.messaging.MessageChannel;
import org.springframework.messaging.SubscribableChannel;

/**
 * input 指的是接收消息的那一端
 * 也就是消费者
 * output 指生产消息的那一端
 * 也就是生产者
 */
public interface DlqTopic {

    /**
     * 把两个 信道绑定在一起
     */
    String INPUT = "dlq-consumer";

    String OUTPUT = "dlq-producer";

    // topic的名称
    @Input(INPUT)
    SubscribableChannel input();

    /**
     * INPUT 会当成一个 Bean 的 name
     * 相当于声明了 2 个 Bean 都有同样的 name Spring 启动的时候就会报错
     */
    @Output(OUTPUT)
    MessageChannel output();

}

```

![](https://tcs.teambition.net/storage/3122853b62b0bab767e1c4150f86f0ebbee1?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NTA3MywiaWF0IjoxNjEyMTkwMjczLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjI4NTNiNjJiMGJhYjc2N2UxYzQxNTBmODZmMGViYmVlMSJ9.ZXpBqs-72QpY7JGbwJ_jRQ8dxGu52LUaLf8E4YwrzAs&download=image.png "")

```java
package com.imooc.springcloud.biz;

import com.imooc.springcloud.topic.*;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.messaging.support.MessageBuilder;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

@RestController
@Slf4j
public class Controller {

    @Autowired
    private MyTopic producer;

    @Autowired
    private GroupTopic groupTopicProducer;

    @Autowired
    private DelayedTopic delayedTopicProducer;

    @Autowired
    private ErrorTopic errorTopicProducer;

    @Autowired
    private RequeueTopic requeueTopicProducer;

    @Autowired
    private DlqTopic dlqTopicProducer;

    @PostMapping("send")
    public void sendMessage(@RequestParam(value = "body") String body) {
        producer.output().send(MessageBuilder.withPayload(body).build());
    }

    @PostMapping("sendToGroup")
    public void sendMessageToGroup(@RequestParam(value = "body") String body) {
        groupTopicProducer.output().send(MessageBuilder.withPayload(body).build());
    }

    @PostMapping("sendDM")
    public void sendDelayedMessage(@RequestParam(value = "body") String body,
                                   @RequestParam(value = "seconds") Integer seconds) {
        MessageBean msg = new MessageBean();
        msg.setPayload(body);
        log.info("ready to send delayed message");
        delayedTopicProducer.output().send(
                MessageBuilder.withPayload(msg)
                        /**
                         * x-delay 延迟消息就会把它延迟多少秒之后 送达到消费者这里
                         */
                        .setHeader("x-delay",1000 * seconds)
                        .build());
    }


    /**
     * 异常重试（单机版）
     * 只会在本机重试 也就是说是在Consumer 范围内的重试
     */
    @PostMapping("sendError")
    public void sendErrorMessage(@RequestParam(value = "body") String body) {
        MessageBean msg = new MessageBean();
        msg.setPayload(body);
        errorTopicProducer.output().send(MessageBuilder.withPayload(msg).build());
    }

    /**
     * 异常重试（联机版 - 重新入队）
     */
    @PostMapping("requeue")
    public void sendErrorMessageToMQ(@RequestParam(value = "body") String body) {
        MessageBean msg = new MessageBean();
        msg.setPayload(body);
        requeueTopicProducer.output().send(MessageBuilder.withPayload(msg).build());
    }

    /**
     * 死信队列测试
     */
    @PostMapping("dlq")
    public void sendMessageToDlq(@RequestParam(value = "body") String body) {
        MessageBean msg = new MessageBean();
        msg.setPayload(body);
        requeueTopicProducer.output().send(MessageBuilder.withPayload(msg).build());
    }



}

```

![](https://tcs.teambition.net/storage/31224bbc2a1190d9367d1ef65c082fe2b8b3?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NTA3MywiaWF0IjoxNjEyMTkwMjczLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjI0YmJjMmExMTkwZDkzNjdkMWVmNjVjMDgyZmUyYjhiMyJ9.vvumqXBind2fxQxTEXKnGIxXiVlaEncMRqN7kRCI-w8&download=image.png "")

```java
package com.imooc.springcloud.biz;

import com.imooc.springcloud.topic.*;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.messaging.support.MessageBuilder;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

@RestController
@Slf4j
public class Controller {

    @Autowired
    private MyTopic producer;

    @Autowired
    private GroupTopic groupTopicProducer;

    @Autowired
    private DelayedTopic delayedTopicProducer;

    @Autowired
    private ErrorTopic errorTopicProducer;

    @Autowired
    private RequeueTopic requeueTopicProducer;

    @Autowired
    private DlqTopic dlqTopicProducer;

    @PostMapping("send")
    public void sendMessage(@RequestParam(value = "body") String body) {
        producer.output().send(MessageBuilder.withPayload(body).build());
    }

    @PostMapping("sendToGroup")
    public void sendMessageToGroup(@RequestParam(value = "body") String body) {
        groupTopicProducer.output().send(MessageBuilder.withPayload(body).build());
    }

    @PostMapping("sendDM")
    public void sendDelayedMessage(@RequestParam(value = "body") String body,
                                   @RequestParam(value = "seconds") Integer seconds) {
        MessageBean msg = new MessageBean();
        msg.setPayload(body);
        log.info("ready to send delayed message");
        delayedTopicProducer.output().send(
                MessageBuilder.withPayload(msg)
                        /**
                         * x-delay 延迟消息就会把它延迟多少秒之后 送达到消费者这里
                         */
                        .setHeader("x-delay",1000 * seconds)
                        .build());
    }


    /**
     * 异常重试（单机版）
     * 只会在本机重试 也就是说是在Consumer 范围内的重试
     */
    @PostMapping("sendError")
    public void sendErrorMessage(@RequestParam(value = "body") String body) {
        MessageBean msg = new MessageBean();
        msg.setPayload(body);
        errorTopicProducer.output().send(MessageBuilder.withPayload(msg).build());
    }

    /**
     * 异常重试（联机版 - 重新入队）
     */
    @PostMapping("requeue")
    public void sendErrorMessageToMQ(@RequestParam(value = "body") String body) {
        MessageBean msg = new MessageBean();
        msg.setPayload(body);
        requeueTopicProducer.output().send(MessageBuilder.withPayload(msg).build());
    }

    /**
     * 死信队列测试
     */
    @PostMapping("dlq")
    public void sendMessageToDlq(@RequestParam(value = "body") String body) {
        MessageBean msg = new MessageBean();
        msg.setPayload(body);
        dlqTopicProducer.output().send(MessageBuilder.withPayload(msg).build());
    }



}


```

![](https://tcs.teambition.net/storage/312259fe2b37e70147582e9069ee9fb27d30?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NTA3MywiaWF0IjoxNjEyMTkwMjczLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjI1OWZlMmIzN2U3MDE0NzU4MmU5MDY5ZWU5ZmIyN2QzMCJ9.0g6ThQCHWKSbyZQcZPfeRz1Pt1xA0C12I6Q8tUF-QpI&download=image.png "")

```text
spring.application.name=stream-sample
#server.port=63001
#server.port=63000
#server.port=63002
server.port=63003

# RabbitMQ连接字符串
spring.rabbitmq.host=localhost
spring.rabbitmq.port=5672
spring.rabbitmq.username=guest
spring.rabbitmq.password=guest

# 把两个不同名称的信道 绑定 在一起 重定向到 目的地 一个真正的 Topic
# 不同的信道 绑定到相同的 Topic当中 当生产者发送消息 到指定的 Topic 消费者就可以消费
# 绑定Channel到broadcast
spring.cloud.stream.bindings.myTopic-consumer.destination=broadcast
spring.cloud.stream.bindings.myTopic-producer.destination=broadcast

# 消息分组示例
spring.cloud.stream.bindings.group-consumer.destination=group-topic
spring.cloud.stream.bindings.group-producer.destination=group-topic
# 消息分组是对与消费者来说 划分到组A当中
spring.cloud.stream.bindings.group-consumer.group=Group-A

# 延迟消息配置
spring.cloud.stream.bindings.delayed-consumer.destination=delayed-topic
spring.cloud.stream.bindings.delayed-producer.destination=delayed-topic

# 声明 Queue exchange 类型 创建延迟队列 指定producer exchange类型 delayed Queue 看会有一个DM标签
# 显示为 x-delayed-message
spring.cloud.stream.rabbit.bindings.delayed-producer.producer.delayed-exchange=true

# 异常消息（单机版重试）
spring.cloud.stream.bindings.error-consumer.destination=error-out-topic
spring.cloud.stream.bindings.error-producer.destination=error-out-topic
# 重试次数（本机重试）在当前的Consumer当中不断的重试消息 而不会把消息重新发回给 rabbitmq 是在客户端消费者这里
# 次数=1相当于不重试 最大尝试次数 1 没有重试 它消费这条消息当次 就算是第一次了
spring.cloud.stream.bindings.error-consumer.consumer.max-attempts=2



# 异常消息（requeue重试）
spring.cloud.stream.bindings.requeue-consumer.destination=requeue-topic
spring.cloud.stream.bindings.requeue-producer.destination=requeue-topic
# 冲突问题 retry的次数 如果配置了retry次数 也就是指定了 它在原地retry 失败以后 还会把它添加queue里面吗？
# 不会了 要强制的它的retry次数 指定成 1 也就是说 我不让你在原地 retry 失败了就立马 把这个失败消息 退回到rabbitmq当中
# 重新添加进去 让其他consumer 可以消费它
# 必须把max-attempts 设置为 1，否则requeue功能就不能生效
spring.cloud.stream.bindings.error-consumer.consumer.max-attempts=1
spring.cloud.stream.bindings.group-consumer.group=requeue-group
# 开启requeue 功能
# 仅对当前requeue-consumer，开启requeue
spring.cloud.stream.rabbit.bindings.requeue-consumer.consumer.requeueRejected=true



# 在全局范围内开启重新入队
# 默认全局开启requeue
# spring.rabbitmq.listener.default-requeue-rejected=true


# 死信队列配置
spring.cloud.stream.bindings.dlq-consumer.destination=dlq-topic
spring.cloud.stream.bindings.dlq-producer.destination=dlq-topic
# 这里可以理解为尝试次数 在接收消息后 消费一次以后 还要重新尝试retry一次 这里不是requeue
spring.cloud.stream.bindings.dlq-consumer.consumer.max-attempts=2
spring.cloud.stream.bindings.dlq-consumer.group=dlq-group
# 专门给死信队列的一个配置 在初始化项目的时候 stream 就会向mq 添加一个死信队列
# 死信队列的名称 默认就是topic.dlq
# 开启死信队列，会创建一个默认死信队列 名称就是 topic.dlq
spring.cloud.stream.rabbit.bindings.dlq-consumer.consumer.auto-bind-dlq=true


# 消费分区配置
# 消费分区最终会落实在consumer里 所以要把consumer的消费分区功能打开
# 打开消费者的消费分区功能
spring.cloud.stream.bindings.group-consumer.consumer.partitioned=true

# 使用生产者来配置消费分区数量
# 两个消费分区
spring.cloud.stream.bindings.group-producer.producer.partition-count=2

# 如何识别消费分区
# SpEL表达式（Key resolver）
# 只有索引参数为1的节点（消费者），才能消费消息
# 通过生产者的 key expression配置 只有参数为1的节点消费者才能接收到数据
spring.cloud.stream.bindings.group-producer.producer.partition-key-expression=1

# 当前消费者实例总数
spring.cloud.stream.instanceCount=2

# 索引参数 跟上面搭配使用 最大值是 instanceCount-1
# 表示当前实例的索引号
#spring.cloud.stream.instanceIndex=0
spring.cloud.stream.instanceIndex=1

management.endpoints.web.exposure.include=*
management.endpoint.health.show-details=always

```

![](https://tcs.teambition.net/storage/3122f56ff4e03e19dfc3ef715cf3de292456?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NTA3MywiaWF0IjoxNjEyMTkwMjczLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjJmNTZmZjRlMDNlMTlkZmMzZWY3MTVjZjNkZTI5MjQ1NiJ9.scDd_-rSSVvacl3DQhhA85wdDe5UZOJsl1fRYPd_530&download=image.png "")

![](https://tcs.teambition.net/storage/31226e02b79c3c3abd3fb3b38f40d6974a42?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NTA3MywiaWF0IjoxNjEyMTkwMjczLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjI2ZTAyYjc5YzNjM2FiZDNmYjNiMzhmNDBkNjk3NGE0MiJ9.nY1Xr9OvoTEttvra7-YJyRjD0Yx6qECP3lksPCdUx-g&download=image.png "")

![](https://tcs.teambition.net/storage/3122d75e5eb211fbab77e47047c1d1d47e93?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NTA3MywiaWF0IjoxNjEyMTkwMjczLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjJkNzVlNWViMjExZmJhYjc3ZTQ3MDQ3YzFkMWQ0N2U5MyJ9.A7swaJBXYZ84SXCbudLx5NiWVJ8CVBC03qRYAwba-aY&download=image.png "")

说明它是一个可以 往死信队列中 转发message的queue

![](https://tcs.teambition.net/storage/3122ab3f6d2a6820039fefddf96e9e95ce69?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NTA3MywiaWF0IjoxNjEyMTkwMjczLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjJhYjNmNmQyYTY4MjAwMzlmZWZkZGY5NmU5ZTk1Y2U2OSJ9.MEVFs90TKe36RnUkL-Oq7yw9hHFKs8jKwmxZEVTvB-Y&download=image.png "")

![](https://tcs.teambition.net/storage/3122feb3ab9e0b4f3d491b8d957d6cf6596c?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NTA3MywiaWF0IjoxNjEyMTkwMjczLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjJmZWIzYWI5ZTBiNGYzZDQ5MWI4ZDk1N2Q2Y2Y2NTk2YyJ9.ZEKe5WVwM8dIrpQ0c8T_04MiKemLDG3OiMEZn4XCVn8&download=image.png "")

```text
2021-01-31 17:52:04.910  INFO 60715 --- [pic.dlq-group-1] c.imooc.springcloud.biz.StreamConsumer   : Dlq - Are you OK?
2021-01-31 17:52:04.911  INFO 60715 --- [pic.dlq-group-1] c.imooc.springcloud.biz.StreamConsumer   : Dlq - What's your problem?
2021-01-31 17:52:05.919  INFO 60715 --- [pic.dlq-group-1] c.imooc.springcloud.biz.StreamConsumer   : Dlq - Are you OK?
2021-01-31 17:52:05.919  INFO 60715 --- [pic.dlq-group-1] c.imooc.springcloud.biz.StreamConsumer   : Dlq - Fine, thank you. And you?
2021-01-31 17:52:12.284  INFO 60715 --- [pic.dlq-group-1] c.imooc.springcloud.biz.StreamConsumer   : Dlq - Are you OK?
2021-01-31 17:52:12.284  INFO 60715 --- [pic.dlq-group-1] c.imooc.springcloud.biz.StreamConsumer   : Dlq - What's your problem?
2021-01-31 17:52:13.290  INFO 60715 --- [pic.dlq-group-1] c.imooc.springcloud.biz.StreamConsumer   : Dlq - Are you OK?
2021-01-31 17:52:13.290  INFO 60715 --- [pic.dlq-group-1] c.imooc.springcloud.biz.StreamConsumer   : Dlq - What's your problem?
2021-01-31 17:52:13.297 ERROR 60715 --- [pic.dlq-group-1] o.s.integration.handler.LoggingHandler   : org.springframework.messaging.MessagingException: Exception thrown while invoking com.imooc.springcloud.biz.StreamConsumer#consumeDlqMessage[1 args]; nested exception is java.lang.RuntimeException: I'm not OK, failedMessage=GenericMessage [payload=byte[18], headers={amqp_receivedDeliveryMode=PERSISTENT, amqp_receivedExchange=dlq-topic, amqp_deliveryTag=2, deliveryAttempt=2, amqp_consumerQueue=dlq-topic.dlq-group, amqp_redelivered=false, amqp_receivedRoutingKey=dlq-topic, amqp_timestamp=Sun Jan 31 17:52:12 CST 2021, amqp_messageId=4a6d6dbe-5b0b-0cec-c6b7-150e246ce6d2, id=34c69c2c-487a-a2b6-46de-4822a492b5ec, amqp_consumerTag=amq.ctag-AWHlWBFOrShdAdh0cV2OsQ, contentType=application/json, timestamp=1612086732283}]
	at org.springframework.cloud.stream.binding.StreamListenerMessageHandler.handleRequestMessage(StreamListenerMessageHandler.java:64)
	at org.springframework.integration.handler.AbstractReplyProducingMessageHandler.handleMessageInternal(AbstractReplyProducingMessageHandler.java:123)
	at org.springframework.integration.handler.AbstractMessageHandler.handleMessage(AbstractMessageHandler.java:169)
	at org.springframework.integration.dispatcher.AbstractDispatcher.tryOptimizedDispatch(AbstractDispatcher.java:115)
	at org.springframework.integration.dispatcher.UnicastingDispatcher.doDispatch(UnicastingDispatcher.java:132)
	at org.springframework.integration.dispatcher.UnicastingDispatcher.dispatch(UnicastingDispatcher.java:105)
	at org.springframework.integration.channel.AbstractSubscribableChannel.doSend(AbstractSubscribableChannel.java:73)
	at org.springframework.integration.channel.AbstractMessageChannel.send(AbstractMessageChannel.java:453)
	at org.springframework.integration.channel.AbstractMessageChannel.send(AbstractMessageChannel.java:401)
	at org.springframework.messaging.core.GenericMessagingTemplate.doSend(GenericMessagingTemplate.java:187)
	at org.springframework.messaging.core.GenericMessagingTemplate.doSend(GenericMessagingTemplate.java:166)
	at org.springframework.messaging.core.GenericMessagingTemplate.doSend(GenericMessagingTemplate.java:47)
	at org.springframework.messaging.core.AbstractMessageSendingTemplate.send(AbstractMessageSendingTemplate.java:109)
	at org.springframework.integration.endpoint.MessageProducerSupport.sendMessage(MessageProducerSupport.java:205)
	at org.springframework.integration.amqp.inbound.AmqpInboundChannelAdapter.access$1200(AmqpInboundChannelAdapter.java:57)
	at org.springframework.integration.amqp.inbound.AmqpInboundChannelAdapter$Listener.lambda$onMessage$0(AmqpInboundChannelAdapter.java:223)
	at org.springframework.retry.support.RetryTemplate.doExecute(RetryTemplate.java:287)
	at org.springframework.retry.support.RetryTemplate.execute(RetryTemplate.java:180)
	at org.springframework.integration.amqp.inbound.AmqpInboundChannelAdapter$Listener.onMessage(AmqpInboundChannelAdapter.java:220)
	at org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.doInvokeListener(AbstractMessageListenerContainer.java:1542)
	at org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.actualInvokeListener(AbstractMessageListenerContainer.java:1468)
	at org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.invokeListener(AbstractMessageListenerContainer.java:1456)
	at org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:1451)
	at org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.executeListener(AbstractMessageListenerContainer.java:1400)
	at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.doReceiveAndExecute(SimpleMessageListenerContainer.java:875)
	at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.receiveAndExecute(SimpleMessageListenerContainer.java:859)
	at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.access$1600(SimpleMessageListenerContainer.java:78)
	at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer$AsyncMessageProcessingConsumer.mainLoop(SimpleMessageListenerContainer.java:1142)
	at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer$AsyncMessageProcessingConsumer.run(SimpleMessageListenerContainer.java:1048)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.lang.RuntimeException: I'm not OK
	at com.imooc.springcloud.biz.StreamConsumer.consumeDlqMessage(StreamConsumer.java:124)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.messaging.handler.invocation.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:171)
	at org.springframework.messaging.handler.invocation.InvocableHandlerMethod.invoke(InvocableHandlerMethod.java:120)
	at org.springframework.cloud.stream.binding.StreamListenerMessageHandler.handleRequestMessage(StreamListenerMessageHandler.java:55)
	... 29 more
2021-01-31 17:52:13.314  WARN 60715 --- [pic.dlq-group-1] s.a.r.l.ConditionalRejectingErrorHandler : Execution of Rabbit message listener failed.

org.springframework.amqp.rabbit.listener.exception.ListenerExecutionFailedException: Listener threw exception
	at org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.wrapToListenerExecutionFailedExceptionIfNeeded(AbstractMessageListenerContainer.java:1641) ~[spring-rabbit-2.1.15.RELEASE.jar:2.1.15.RELEASE]
	at org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.doInvokeListener(AbstractMessageListenerContainer.java:1545) ~[spring-rabbit-2.1.15.RELEASE.jar:2.1.15.RELEASE]
	at org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.actualInvokeListener(AbstractMessageListenerContainer.java:1468) ~[spring-rabbit-2.1.15.RELEASE.jar:2.1.15.RELEASE]
	at org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.invokeListener(AbstractMessageListenerContainer.java:1456) ~[spring-rabbit-2.1.15.RELEASE.jar:2.1.15.RELEASE]
	at org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:1451) ~[spring-rabbit-2.1.15.RELEASE.jar:2.1.15.RELEASE]
	at org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.executeListener(AbstractMessageListenerContainer.java:1400) ~[spring-rabbit-2.1.15.RELEASE.jar:2.1.15.RELEASE]
	at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.doReceiveAndExecute(SimpleMessageListenerContainer.java:875) [spring-rabbit-2.1.15.RELEASE.jar:2.1.15.RELEASE]
	at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.receiveAndExecute(SimpleMessageListenerContainer.java:859) [spring-rabbit-2.1.15.RELEASE.jar:2.1.15.RELEASE]
	at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.access$1600(SimpleMessageListenerContainer.java:78) [spring-rabbit-2.1.15.RELEASE.jar:2.1.15.RELEASE]
	at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer$AsyncMessageProcessingConsumer.mainLoop(SimpleMessageListenerContainer.java:1142) [spring-rabbit-2.1.15.RELEASE.jar:2.1.15.RELEASE]
	at org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer$AsyncMessageProcessingConsumer.run(SimpleMessageListenerContainer.java:1048) [spring-rabbit-2.1.15.RELEASE.jar:2.1.15.RELEASE]
	at java.lang.Thread.run(Thread.java:748) [na:1.8.0_181]
Caused by: org.springframework.messaging.MessageDeliveryException: failed to send Message to channel 'dlq-topic.dlq-group.errors'; nested exception is org.springframework.amqp.rabbit.listener.exception.ListenerExecutionFailedException: Retry Policy Exhausted
	at org.springframework.integration.support.utils.IntegrationUtils.wrapInDeliveryExceptionIfNecessary(IntegrationUtils.java:166) ~[spring-integration-core-5.1.11.RELEASE.jar:5.1.11.RELEASE]
	at org.springframework.integration.channel.AbstractMessageChannel.send(AbstractMessageChannel.java:483) ~[spring-integration-core-5.1.11.RELEASE.jar:5.1.11.RELEASE]
	at org.springframework.integration.channel.AbstractMessageChannel.send(AbstractMessageChannel.java:401) ~[spring-integration-core-5.1.11.RELEASE.jar:5.1.11.RELEASE]
	at org.springframework.messaging.core.GenericMessagingTemplate.doSend(GenericMessagingTemplate.java:187) ~[spring-messaging-5.1.16.RELEASE.jar:5.1.16.RELEASE]
	at org.springframework.messaging.core.GenericMessagingTemplate.doSend(GenericMessagingTemplate.java:166) ~[spring-messaging-5.1.16.RELEASE.jar:5.1.16.RELEASE]
	at org.springframework.messaging.core.GenericMessagingTemplate.doSend(GenericMessagingTemplate.java:47) ~[spring-messaging-5.1.16.RELEASE.jar:5.1.16.RELEASE]
	at org.springframework.messaging.core.AbstractMessageSendingTemplate.send(AbstractMessageSendingTemplate.java:109) ~[spring-messaging-5.1.16.RELEASE.jar:5.1.16.RELEASE]
	at org.springframework.messaging.core.AbstractMessageSendingTemplate.send(AbstractMessageSendingTemplate.java:99) ~[spring-messaging-5.1.16.RELEASE.jar:5.1.16.RELEASE]
	at org.springframework.integration.core.ErrorMessagePublisher.publish(ErrorMessagePublisher.java:168) ~[spring-integration-core-5.1.11.RELEASE.jar:5.1.11.RELEASE]
	at org.springframework.integration.handler.advice.ErrorMessageSendingRecoverer.recover(ErrorMessageSendingRecoverer.java:83) ~[spring-integration-core-5.1.11.RELEASE.jar:5.1.11.RELEASE]
	at org.springframework.retry.support.RetryTemplate.handleRetryExhausted(RetryTemplate.java:512) ~[spring-retry-1.2.5.RELEASE.jar:na]
	at org.springframework.retry.support.RetryTemplate.doExecute(RetryTemplate.java:351) ~[spring-retry-1.2.5.RELEASE.jar:na]
	at org.springframework.retry.support.RetryTemplate.execute(RetryTemplate.java:180) ~[spring-retry-1.2.5.RELEASE.jar:na]
	at org.springframework.integration.amqp.inbound.AmqpInboundChannelAdapter$Listener.onMessage(AmqpInboundChannelAdapter.java:220) ~[spring-integration-amqp-5.1.11.RELEASE.jar:5.1.11.RELEASE]
	at org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.doInvokeListener(AbstractMessageListenerContainer.java:1542) ~[spring-rabbit-2.1.15.RELEASE.jar:2.1.15.RELEASE]
	... 10 common frames omitted
Caused by: org.springframework.amqp.rabbit.listener.exception.ListenerExecutionFailedException: Retry Policy Exhausted
	at org.springframework.amqp.rabbit.retry.RejectAndDontRequeueRecoverer.recover(RejectAndDontRequeueRecoverer.java:45) ~[spring-rabbit-2.1.15.RELEASE.jar:2.1.15.RELEASE]
	at org.springframework.cloud.stream.binder.rabbit.RabbitMessageChannelBinder$3.handleMessage(RabbitMessageChannelBinder.java:628) ~[spring-cloud-stream-binder-rabbit-2.1.2.RELEASE.jar:2.1.2.RELEASE]
	at org.springframework.integration.dispatcher.BroadcastingDispatcher.invokeHandler(BroadcastingDispatcher.java:224) ~[spring-integration-core-5.1.11.RELEASE.jar:5.1.11.RELEASE]
	at org.springframework.integration.dispatcher.BroadcastingDispatcher.dispatch(BroadcastingDispatcher.java:180) ~[spring-integration-core-5.1.11.RELEASE.jar:5.1.11.RELEASE]
	at org.springframework.integration.channel.AbstractSubscribableChannel.doSend(AbstractSubscribableChannel.java:73) ~[spring-integration-core-5.1.11.RELEASE.jar:5.1.11.RELEASE]
	at org.springframework.integration.channel.AbstractMessageChannel.send(AbstractMessageChannel.java:453) ~[spring-integration-core-5.1.11.RELEASE.jar:5.1.11.RELEASE]
	... 23 common frames omitted
Caused by: org.springframework.amqp.AmqpRejectAndDontRequeueException: null
	... 29 common frames omitted
Caused by: org.springframework.messaging.MessagingException: Exception thrown while invoking com.imooc.springcloud.biz.StreamConsumer#consumeDlqMessage[1 args]; nested exception is java.lang.RuntimeException: I'm not OK
	at org.springframework.cloud.stream.binding.StreamListenerMessageHandler.handleRequestMessage(StreamListenerMessageHandler.java:64) ~[spring-cloud-stream-2.1.2.RELEASE.jar:2.1.2.RELEASE]
	at org.springframework.integration.handler.AbstractReplyProducingMessageHandler.handleMessageInternal(AbstractReplyProducingMessageHandler.java:123) ~[spring-integration-core-5.1.11.RELEASE.jar:5.1.11.RELEASE]
	at org.springframework.integration.handler.AbstractMessageHandler.handleMessage(AbstractMessageHandler.java:169) ~[spring-integration-core-5.1.11.RELEASE.jar:5.1.11.RELEASE]
	at org.springframework.integration.dispatcher.AbstractDispatcher.tryOptimizedDispatch(AbstractDispatcher.java:115) ~[spring-integration-core-5.1.11.RELEASE.jar:5.1.11.RELEASE]
	at org.springframework.integration.dispatcher.UnicastingDispatcher.doDispatch(UnicastingDispatcher.java:132) ~[spring-integration-core-5.1.11.RELEASE.jar:5.1.11.RELEASE]
	at org.springframework.integration.dispatcher.UnicastingDispatcher.dispatch(UnicastingDispatcher.java:105) ~[spring-integration-core-5.1.11.RELEASE.jar:5.1.11.RELEASE]
	at org.springframework.integration.channel.AbstractSubscribableChannel.doSend(AbstractSubscribableChannel.java:73) ~[spring-integration-core-5.1.11.RELEASE.jar:5.1.11.RELEASE]
	at org.springframework.integration.channel.AbstractMessageChannel.send(AbstractMessageChannel.java:453) ~[spring-integration-core-5.1.11.RELEASE.jar:5.1.11.RELEASE]
	at org.springframework.integration.channel.AbstractMessageChannel.send(AbstractMessageChannel.java:401) ~[spring-integration-core-5.1.11.RELEASE.jar:5.1.11.RELEASE]
	at org.springframework.messaging.core.GenericMessagingTemplate.doSend(GenericMessagingTemplate.java:187) ~[spring-messaging-5.1.16.RELEASE.jar:5.1.16.RELEASE]
	at org.springframework.messaging.core.GenericMessagingTemplate.doSend(GenericMessagingTemplate.java:166) ~[spring-messaging-5.1.16.RELEASE.jar:5.1.16.RELEASE]
	at org.springframework.messaging.core.GenericMessagingTemplate.doSend(GenericMessagingTemplate.java:47) ~[spring-messaging-5.1.16.RELEASE.jar:5.1.16.RELEASE]
	at org.springframework.messaging.core.AbstractMessageSendingTemplate.send(AbstractMessageSendingTemplate.java:109) ~[spring-messaging-5.1.16.RELEASE.jar:5.1.16.RELEASE]
	at org.springframework.integration.endpoint.MessageProducerSupport.sendMessage(MessageProducerSupport.java:205) ~[spring-integration-core-5.1.11.RELEASE.jar:5.1.11.RELEASE]
	at org.springframework.integration.amqp.inbound.AmqpInboundChannelAdapter.access$1200(AmqpInboundChannelAdapter.java:57) ~[spring-integration-amqp-5.1.11.RELEASE.jar:5.1.11.RELEASE]
	at org.springframework.integration.amqp.inbound.AmqpInboundChannelAdapter$Listener.lambda$onMessage$0(AmqpInboundChannelAdapter.java:223) ~[spring-integration-amqp-5.1.11.RELEASE.jar:5.1.11.RELEASE]
	at org.springframework.retry.support.RetryTemplate.doExecute(RetryTemplate.java:287) ~[spring-retry-1.2.5.RELEASE.jar:na]
	... 13 common frames omitted
Caused by: java.lang.RuntimeException: I'm not OK
	at com.imooc.springcloud.biz.StreamConsumer.consumeDlqMessage(StreamConsumer.java:124) ~[classes/:na]
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:1.8.0_181]
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[na:1.8.0_181]
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:1.8.0_181]
	at java.lang.reflect.Method.invoke(Method.java:498) ~[na:1.8.0_181]
	at org.springframework.messaging.handler.invocation.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:171) ~[spring-messaging-5.1.16.RELEASE.jar:5.1.16.RELEASE]
	at org.springframework.messaging.handler.invocation.InvocableHandlerMethod.invoke(InvocableHandlerMethod.java:120) ~[spring-messaging-5.1.16.RELEASE.jar:5.1.16.RELEASE]
	at org.springframework.cloud.stream.binding.StreamListenerMessageHandler.handleRequestMessage(StreamListenerMessageHandler.java:55) ~[spring-cloud-stream-2.1.2.RELEASE.jar:2.1.2.RELEASE]
	... 29 common frames omitted



```

![](https://tcs.teambition.net/storage/31221883e727a830f1fb4e4c09effac66aa0?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NTA3MywiaWF0IjoxNjEyMTkwMjczLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjIxODgzZTcyN2E4MzBmMWZiNGU0YzA5ZWZmYWM2NmFhMCJ9.yixWaTwI0J0X5qgwfio6uqFb33spE7nOUm7pxHe2f-s&download=image.png "")

死信队列数字变了 增加了 1

把消息转发到了死信队列

![](https://tcs.teambition.net/storage/31226d0ef943d8edfcda9340cd998a88c91c?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NTA3MywiaWF0IjoxNjEyMTkwMjczLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjI2ZDBlZjk0M2Q4ZWRmY2RhOTM0MGNkOTk4YTg4YzkxYyJ9.Kq8y18sfxBY3ce6Mb0ykGvNEVTOkpwXxQOClnlMKKdU&download=image.png "")

重新发到一个新的queue里面

![](https://tcs.teambition.net/storage/312279eb9c89bad31b8e80c5b16bea6bc427?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NTA3MywiaWF0IjoxNjEyMTkwMjczLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjI3OWViOWM4OWJhZDMxYjhlODBjNWIxNmJlYTZiYzQyNyJ9.7aaPUlaPuXqvlc9RfVffT_J_hn9TKl_H5nzFddl269k&download=image.png "")

![](https://tcs.teambition.net/storage/3122835cb978a8ed4ca00ecc53cd24d7fdaa?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NTA3MywiaWF0IjoxNjEyMTkwMjczLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjI4MzVjYjk3OGE4ZWQ0Y2EwMGVjYzUzY2QyNGQ3ZmRhYSJ9.KzbRhEojFAx_ZrO8JBn8h7YxuQoRKnz5KrwbchJs2eg&download=image.png "")

![](https://tcs.teambition.net/storage/31220292eae5536db0c181e73de2561dc9fe?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NTA3MywiaWF0IjoxNjEyMTkwMjczLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjIwMjkyZWFlNTUzNmRiMGMxODFlNzNkZTI1NjFkYzlmZSJ9.Cx6TR5AQjLi-xrA2neE7erv8cN6-RRrSpKHp_NZO1P8&download=image.png "")

```text
2021-01-31 17:59:54.461  INFO 60715 --- [pic.dlq-group-1] c.imooc.springcloud.biz.StreamConsumer   : Dlq - Are you OK?
2021-01-31 17:59:54.465  INFO 60715 --- [pic.dlq-group-1] c.imooc.springcloud.biz.StreamConsumer   : Dlq - Fine, thank you. And you?


```



开源笔记

可 Pull Requests 协作写开源笔记

如果笔记图片无法访问 请访问 [teambition](https://tburl.in/0jDNvpbK) 原版开源笔记

gitee

[https://gitee.com/opendevel/java-for-linux](https://gitee.com/opendevel/java-for-linux)

github

[https://github.com/OSrcD/java-for-linux](https://github.com/OSrcD/java-for-linux)

teambition

[https://tburl.in/0jDNvpbK](https://tburl.in/0jDNvpbK)

开源视频

bilibili

[https://space.bilibili.com/77266754](https://space.bilibili.com/77266754)

开源博客

oschina

[https://my.oschina.net/u/4675154](https://my.oschina.net/u/4675154)

csdn

[https://blog.csdn.net/OpenDevel](https://blog.csdn.net/OpenDevel)

开源项目

gitee

[https://gitee.com/opendevel](https://gitee.com/opendevel)

github

[https://github.com/OSrcD](https://github.com/OSrcD)

开源赞赏

![](https://tcs.teambition.net/storage/3121aed56e96d914e1046f3b498b493ce232?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjc5NTA3MywiaWF0IjoxNjEyMTkwMjczLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjFhZWQ1NmU5NmQ5MTRlMTA0NmYzYjQ5OGI0OTNjZTIzMiJ9.-pHS552dgNBcOKe2ARIpneCqr1-WNkk38JK_sVb6ctQ&download=image.png "")

