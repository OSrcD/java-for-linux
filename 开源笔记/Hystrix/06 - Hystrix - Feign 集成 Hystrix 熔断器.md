![](https://tcs.teambition.net/storage/3121e2fb6cf529e3a3d9b320cd8804a8e86c?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0OSwiaWF0IjoxNjExNDY1NzQ5LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjFlMmZiNmNmNTI5ZTNhM2Q5YjMyMGNkODgwNGE4ZTg2YyJ9.dp_f0DxlX_VWbqwsrdgwpYz0BAcg8zmqklH8JHQivMQ&download=2020-09-17%20054547.png "")



![](https://tcs.teambition.net/storage/31219fc456b59a795a8b75b21751ebf83b9a?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0OSwiaWF0IjoxNjExNDY1NzQ5LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE5ZmM0NTZiNTlhNzk1YThiNzViMjE3NTFlYmY4M2I5YSJ9.WSeM_us9yEpE_kfXYT4cjdmccSdUsf-uF0dCf-dBhBs&download=2020-09-17%20054611.png "")

![](https://tcs.teambition.net/storage/312128d92463c289e8c57195c3a34ebf217d?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0OSwiaWF0IjoxNjExNDY1NzQ5LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjEyOGQ5MjQ2M2MyODllOGM1NzE5NWMzYTM0ZWJmMjE3ZCJ9.FVyXHYVcqCCqKEIr7cs8A5I-663pbzQje-jhoQY-55M&download=image.png "")

熔断器的全局开启 默认是开启状态

开启或关闭熔断的功能

![](https://tcs.teambition.net/storage/312192722b2a011187a62a13aecccb8be038?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0OSwiaWF0IjoxNjExNDY1NzQ5LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE5MjcyMmIyYTAxMTE4N2E2MmExM2FlY2NjYjhiZTAzOCJ9.d44xe8pPIxpYPeJqkGMflH6rnvKco6iisY4MtAX6aps&download=image.png "")

启动

![](https://tcs.teambition.net/storage/31212d7782d3b4b650bbf8ac3e69929c1bfd?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0OSwiaWF0IjoxNjExNDY1NzQ5LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjEyZDc3ODJkM2I0YjY1MGJiZjhhYzNlNjk5MjljMWJmZCJ9.De-dfjeNB5AaRNAjEVUDxYq9j_bTAYg5-OkOQZVr8Ak&download=image.png "")

在 15 秒内 至少完成 6次 调用

![](https://tcs.teambition.net/storage/31219b6757e2cc88cd70d0c34150cf25fb79?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0OSwiaWF0IjoxNjExNDY1NzQ5LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE5YjY3NTdlMmNjODhjZDcwZDBjMzQxNTBjZjI1ZmI3OSJ9.YmwA1JKo_algimR0SkvVFkqqcuiMgOg8Q2Ca0JweeOU&download=image.png "")

成功的请求

![](https://tcs.teambition.net/storage/3121af85cc66cece36afa49e2c223a6378ac?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0OSwiaWF0IjoxNjExNDY1NzQ5LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjFhZjg1Y2M2NmNlY2UzNmFmYTQ5ZTJjMjIzYTYzNzhhYyJ9.zWLcbqIlDVcqCs1sVKLc11S6qN3R9_PvXgjJ5p-GJfk&download=image.png "")

超过50% 进入熔断

![](https://tcs.teambition.net/storage/31210f8ea613ed8f7fdd0aeb8793129c9614?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0OSwiaWF0IjoxNjExNDY1NzQ5LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjEwZjhlYTYxM2VkOGY3ZmRkMGFlYjg3OTMxMjljOTYxNCJ9.p0DslgpS1zDdzmBuMZRMdds8rmmuduugvfnm9MmRXbk&download=image.png "")

测试半开

进入熔断状态

![](https://tcs.teambition.net/storage/31218d8327bf1e3fcc929d964f595461cb19?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0OSwiaWF0IjoxNjExNDY1NzQ5LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE4ZDgzMjdiZjFlM2ZjYzkyOWQ5NjRmNTk1NDYxY2IxOSJ9.nPe7elXQDhsTR4fWztBq5vyP8UldHJLh53ouRE22hmM&download=image.png "")

不停发送

![](https://tcs.teambition.net/storage/31214a86b6853ad89a36a781bb9e66cd2b7d?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0OSwiaWF0IjoxNjExNDY1NzQ5LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE0YTg2YjY4NTNhZDg5YTM2YTc4MWJiOWU2NmNkMmI3ZCJ9.A8ooNJlegm5A2ZLVrYba_9TkhhMqGuspnkZqNYZ7Wtw&download=image.png "")

## 这个请求进入半开状态

![](https://tcs.teambition.net/storage/31216f5243f7f168c0f8b23c45f87e15c001?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0OSwiaWF0IjoxNjExNDY1NzQ5LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE2ZjUyNDNmN2YxNjhjMGY4YjIzYzQ1Zjg3ZTE1YzAwMSJ9.RbPmk6baf6mt9G7P0ZmWEFtbjwYkIoTmnQ_eYX7mCXs&download=image.png "")

熔断开关处于关闭状态

![](https://tcs.teambition.net/storage/31219cd134a6783cb290727a96251a0548f0?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0OSwiaWF0IjoxNjExNDY1NzQ5LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE5Y2QxMzRhNjc4M2NiMjkwNzI3YTk2MjUxYTA1NDhmMCJ9.jHgdWtxz9lPkMHh3zwIMuUfl0sZ9_cGsCql-ROfUsd0&download=image.png "")

如果这个请求再次失败了 熔断开关就会再次开启

![](https://tcs.teambition.net/storage/31216c6556e4e734f10b53de040407926488?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0OSwiaWF0IjoxNjExNDY1NzQ5LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE2YzY1NTZlNGU3MzRmMTBiNTNkZTA0MDQwNzkyNjQ4OCJ9.W8h0u9cfRo438W0OJkG_fNCtKaJOQc0fn4dvsgPlFJ4&download=image.png "")

15秒多 不是15秒

为什么

我们接口有延迟 1秒钟的功能

哪剩下的 1秒钟 在 FeignClientApplication中 被用来做线程挂起了 

![](https://tcs.teambition.net/storage/3121e75f70d07e2ed893ffecfca3130e913f?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0OSwiaWF0IjoxNjExNDY1NzQ5LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjFlNzVmNzBkMDdlMmVkODkzZmZlY2ZjYTMxMzBlOTEzZiJ9.Nn0qC04Y2Zq3yG6O89PCKeACzrv3H9dIcEuzvZzawEU&download=image.png "")

![](https://tcs.teambition.net/storage/31211fb584b38b8e1fd02da64df937104c3c?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0OSwiaWF0IjoxNjExNDY1NzQ5LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjExZmI1ODRiMzhiOGUxZmQwMmRhNjRkZjkzNzEwNGMzYyJ9.f8zWmgFfr--pBsQnVpwrNSKih-7WDgpX_h9pNlAkNUw&download=image.png "")

```text
spring.application.name=hystrix-consumer
server.port=50000
spring.main.allow-bean-definition-overriding=true
eureka.client.serviceUrl.defaultZone=http://localhost:20000/eureka/

# 开启Feign下面的Hystrix功能
feign.hystrix.enabled=true
# 是否开启服务降级
hystrix.command.default.fallback.enabled=true

# 全局超时
hystrix.command.default.execution.timeout.enabled=true
# 超时时间 针对全局配置添加超时时间
hystrix.command.default.execution.isolation.thread.timeoutInMilliseconds=5000

# 线程中断行为
# 超时以后终止线程 配置超时行为
hystrix.command.default.execution.isolation.thread.interruptOnTimeout=true

# 取消的时候终止线程
hystrix.command.default.execution.isolation.thread.interruptOnFutureCancel=true

# 针对方法的配置
# Service的类名#方法名(方法参数)
# 方法级别的超时优先级高
hystrix.command.MyService#retry(int).execution.isolation.thread.timeoutInMilliseconds=3000

# 开启访问缓存功能
hystrix.command.default.requestCache.enabled=true

# 正儿八经的参数
# 熔断的前提条件（请求的数量），在一定的时间窗口内，请求达到5个以后，才开始进行熔断判断
hystrix.command.default.circuitBreaker.requestVolumeThreshold=5
# 超过50%的失败请求，则熔断开关开启
hystrix.command.default.circuitBreaker.errorThresholdPercentage=50
# 当熔断开启以后，经过多少秒再进入半开状态
hystrix.command.default.circuitBreaker.sleepWindowInMilliseconds=15000
# 配置时间窗口
hystrix.command.default.metrics.rollingStats.timeInMilliseconds=20000



# 打酱油的路人参数
hystrix.command.default.circuitBreaker.enabled=true
# 强制开启熔断开关
hystrix.command.default.circuitBreaker.forceOpen=false
# 强制关闭熔断开关
hystrix.command.default.circuitBreaker.forceClosed=false



# hystrix的超时与ribbon的超时会有冲突
# 每台机器最大重试次数
feign-client.ribbon.MaxAutoRetries=0
# 可以再重试几台机器
feign-client.ribbon.MaxAutoRetriesNextServer=0
# 连接超时
feign-client.ribbon.ConnectTimeout=1000
# 业务处理超时
feign-client.ribbon.ReadTimeout=8000
# 在所有HTTP Method进行重试
feign-client.ribbon.OkToRetryOnAllOperations=false


```

![](https://tcs.teambition.net/storage/3121c2a4b9fcb1c542f3fe90739ffe9921db?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0OSwiaWF0IjoxNjExNDY1NzQ5LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjFjMmE0YjlmY2IxYzU0MmYzZmU5MDczOWZmZTk5MjFkYiJ9.UmxOUQMs2Co1zNp4LU3C8fG-JWHtjb6_8Og5wOA7l7w&download=image.png "")

```java
package com.imooc.springcloud.hystrix;

import com.imooc.springcloud.Friend;
import com.imooc.springcloud.MyService;
import com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Component;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestParam;

/**
 * Fallback 针对MyService容错类
 */
@Slf4j
@Component
public class Fallback implements MyService {

    /**
     * 回调降级方法
     */
    @Override
    @HystrixCommand(fallbackMethod = "fallback2")
    public String error() {
        log.info("Fallback：I'm not a black sheep any more");
        throw new RuntimeException("first fallback");
    }

    @HystrixCommand(fallbackMethod = "fallback3")
    public String fallback2() {
        log.info("fallback again");
        throw new RuntimeException("fallback again");
    }

    public String fallback3() {
        log.info("fallback again and again");
        return "success";
    }

    @Override
    public String sayHi() {
        return null;
    }

    @Override
    public Friend sayHiPost(@RequestBody Friend friend) {
        return null;
    }

    @Override
    public String retry(@RequestParam(name="timeout") int timeout) {
        return "You are late !";
    }

}

```

![](https://tcs.teambition.net/storage/312121e18248bdd3d4e8dbf73c58fa4e2191?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0OSwiaWF0IjoxNjExNDY1NzQ5LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjEyMWUxODI0OGJkZDNkNGU4ZGJmNzNjNThmYTRlMjE5MSJ9.Omi0bcSrc_eyDSSCmVwRVJZ8sXmOWpfJJk8kfErw_FE&download=image.png "")

```java
package com.imooc.springcloud.hystrix;

import com.imooc.springcloud.Friend;
import com.imooc.springcloud.MyService;
import com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand;
import com.netflix.hystrix.contrib.javanica.cache.annotation.CacheKey;
import com.netflix.hystrix.contrib.javanica.cache.annotation.CacheResult;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;


@Slf4j
@Service
public class RequestCacheService {

    @Autowired
    private MyService service;

    @CacheResult
    @HystrixCommand(commandKey = "cacheKey")
    public Friend requestCache(@CacheKey String name) {
        log.info("request cache " + name);
        Friend friend = new Friend();
        friend.setName(name);
        friend = service.sayHiPost(friend);
        log.info("after requesting cache " + name);
        return friend;
    }

}

```

![](https://tcs.teambition.net/storage/3121c4684a8352f1b9df2c202028dda39854?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0OSwiaWF0IjoxNjExNDY1NzQ5LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjFjNDY4NGE4MzUyZjFiOWRmMmMyMDIwMjhkZGEzOTg1NCJ9.WCRzsVt-qPzUhaQfLjcULjIqGnZ621Fck1RZd7O94AA&download=image.png "")

```java
package com.imooc.springcloud;

import com.imooc.springcloud.hystrix.RequestCacheService;
import com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand;
import com.netflix.hystrix.contrib.javanica.annotation.HystrixProperty;
import com.netflix.hystrix.strategy.concurrency.HystrixRequestContext;
import lombok.Cleanup;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;


@RestController
public class Controller {

    @Autowired
    private MyService myService;

    @Autowired
    private RequestCacheService requestCacheService;

    @GetMapping("/fallback")
    public String fallback() {
        return myService.error();
    }

    @GetMapping("/timeout")
    public String timeout(Integer timeout) {
        return myService.retry(timeout);
    }

    @GetMapping("/timeout2")
    @HystrixCommand(
            fallbackMethod = "timeoutFallback",
            /**
             * 指定配置的属性
             * @HystrixProperty 指定单个配置属性 name 是 key value 是值
            */
            commandProperties = {
                @HystrixProperty(name="execution.isolation.thread.timeoutInMilliseconds",value="3000")
            }
    )
    public String timeout2(Integer timeout) {
        return myService.retry(timeout);
    }

    public String timeoutFallback(Integer timeout) {
        return "success";
    }


    @GetMapping("/cache")
    public Friend cache(String name) {

        @Cleanup HystrixRequestContext context =
                HystrixRequestContext.initializeContext();

        Friend friend = requestCacheService.requestCache(name);
        name += "!";
        friend = requestCacheService.requestCache(name);
        return friend;
    }


}

```

![](https://tcs.teambition.net/storage/31216af7effd333a5ceba25d32b39c930b14?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0OSwiaWF0IjoxNjExNDY1NzQ5LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE2YWY3ZWZmZDMzM2E1Y2ViYTI1ZDMyYjM5YzkzMGIxNCJ9.L1FdRSqLZFa8hbOCfYEtoqJkSz8VjitUa2j0ZPEmGxw&download=image.png "")

```java
package com.imooc.springcloud;

import org.springframework.boot.WebApplicationType;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.boot.builder.SpringApplicationBuilder;
import org.springframework.cloud.client.circuitbreaker.EnableCircuitBreaker;
import org.springframework.cloud.client.discovery.EnableDiscoveryClient;
import org.springframework.cloud.openfeign.EnableFeignClients;


@EnableDiscoveryClient
@SpringBootApplication
@EnableFeignClients
@EnableCircuitBreaker // 开启断路器
public class HystrixFallbackApplication {

    public static void main(String[] args) throws NoSuchMethodException {
        new SpringApplicationBuilder(HystrixFallbackApplication.class)
                .web(WebApplicationType.SERVLET)
                .run(args);
        /**
         * 生成方法签名
         * int 也可以class
         */
//        System.out.println(Feign.configKey(MyService.class,
//                MyService.class.getMethod("retry", int.class)));
    }

}

```

![](https://tcs.teambition.net/storage/31212360e3374d49ed7d39ce6f9925f6216c?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0OSwiaWF0IjoxNjExNDY1NzQ5LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjEyMzYwZTMzNzRkNDllZDdkMzljZTZmOTkyNWY2MjE2YyJ9.Ga_WQnxkpXP1dKTZQqz2Pgn9lRP9z69utubK0x3Zwe0&download=image.png "")

```java
package com.imooc.springcloud;

import com.imooc.springcloud.hystrix.Fallback;
import org.springframework.cloud.openfeign.FeignClient;

/**
 * fallback  指定一个类来处理降级异常
 * MyService会将用户请求重新导到了当前Fallback类中 error方法
 */
@FeignClient(name = "feign-client", fallback = Fallback.class)
public interface MyService extends IService {

}

```

![](https://tcs.teambition.net/storage/312150e7fa09aac0b88b203394004a8fa2c0?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0OSwiaWF0IjoxNjExNDY1NzQ5LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE1MGU3ZmEwOWFhYzBiODhiMjAzMzk0MDA0YThmYTJjMCJ9.mrPPy5sy1gOCTeAzpd3yIX_iIRQ0DIww8RnJfM1x_MY&download=image.png "")

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<configuration>
    <appender name="consoleLog" class="ch.qos.logback.core.ConsoleAppender">
        <filter class="ch.qos.logback.classic.filter.ThresholdFilter">
            <level>INFO</level>
        </filter>
        <layout class="ch.qos.logback.classic.PatternLayout">
            <pattern>
                [%d{HH:mm:ss.SSS}] %-5level %logger{15} - %msg%n
            </pattern>
        </layout>
    </appender>

    <appender name="fileLog" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <encoder>
            <pattern>
                [%d{HH:mm:ss.SSS}] %-5level [%thread]%logger{15} - %msg%n
            </pattern>
        </encoder>
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>logs/%d.log</fileNamePattern>
            <maxHistory>30</maxHistory>
        </rollingPolicy>
    </appender>
    <root level="DEBUG">
        <appender-ref ref = "consoleLog"/>
        <appender-ref ref = "fileLog"/>
    </root>
</configuration>
```

![](https://tcs.teambition.net/storage/31214695023743fd257a6685d480308b9be6?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0OSwiaWF0IjoxNjExNDY1NzQ5LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE0Njk1MDIzNzQzZmQyNTdhNjY4NWQ0ODAzMDhiOWJlNiJ9.Sw3Ofo1CsEtkKCcKSBWWEVhJR90FmnonKBKq-O7VKuU&download=image.png "")

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <parent>
        <artifactId>spring-cloud-demo</artifactId>
        <groupId>com.imooc</groupId>
        <version>1.0-SNAPSHOT</version>
        <relativePath>../../pom.xml</relativePath>
    </parent>
    <modelVersion>4.0.0</modelVersion>
    <packaging>jar</packaging>
    <artifactId>hystrix-fallback</artifactId>

    <dependencies>

        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
        </dependency>

        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>

        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-actuator</artifactId>
        </dependency>

        <dependency>
            <groupId>com.imooc</groupId>
            <artifactId>feign-client-intf</artifactId>
            <version>${project.version}</version>
        </dependency>

        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-netflix-hystrix</artifactId>
        </dependency>
    </dependencies>

</project>
```



开源笔记

可 Pull Requests 协作写开源笔记

如果笔记图片无法访问 请访问 [teambition](https://tburl.in/0jDNvpbK) 原版开源笔记

gitee

[https://gitee.com/opendevel/java-for-linux](https://gitee.com/opendevel/java-for-linux)

github

[https://github.com/OSrcD/java-for-linux](https://github.com/OSrcD/java-for-linux)

teambition

[https://tburl.in/0jDNvpbK](https://tburl.in/0jDNvpbK)

开源视频

bilibili

[https://space.bilibili.com/77266754](https://space.bilibili.com/77266754)

开源博客

oschina

[https://my.oschina.net/u/4675154](https://my.oschina.net/u/4675154)

csdn

[https://blog.csdn.net/OpenDevel](https://blog.csdn.net/OpenDevel)

开源项目

gitee

[https://gitee.com/opendevel](https://gitee.com/opendevel)

github

[https://github.com/OSrcD](https://github.com/OSrcD)

开源赞赏

![](https://tcs.teambition.net/storage/3121aed56e96d914e1046f3b498b493ce232?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0OSwiaWF0IjoxNjExNDY1NzQ5LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjFhZWQ1NmU5NmQ5MTRlMTA0NmYzYjQ5OGI0OTNjZTIzMiJ9.paa8jja2Gue9P0iv7Bt1A_x4Gx8chn1yATSiddI1-RU&download=image.png "")

