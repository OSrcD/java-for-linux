![](https://tcs.teambition.net/storage/3121ae0f31af62691a0149ffd7d9e4442836?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0MCwiaWF0IjoxNjExNDY1NzQwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjFhZTBmMzFhZjYyNjkxYTAxNDlmZmQ3ZDllNDQ0MjgzNiJ9.nvUSz-or9R1lPIKSK_AbWu6G03NlAEKsZzw4pGsxtP4&download=image.png "")

![](https://tcs.teambition.net/storage/31212f71d4080a99d2df1e445f783db6f826?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0MCwiaWF0IjoxNjExNDY1NzQwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjEyZjcxZDQwODBhOTlkMmRmMWU0NDVmNzgzZGI2ZjgyNiJ9.nhBl2M72Jd8ifQ50zfcFXo-PMCu5m0uOcQZFCqSC54o&download=image.png "")



启动

![](https://tcs.teambition.net/storage/3121cedf8be97d86c53eed4e59f6f12c969d?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0MCwiaWF0IjoxNjExNDY1NzQwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjFjZWRmOGJlOTdkODZjNTNlZWQ0ZTU5ZjZmMTJjOTY5ZCJ9.mzasRbUdeF5NrrTe0zBSw9anm0kDm3ZC39ONVf2BXhg&download=image.png "")

![](https://tcs.teambition.net/storage/312150e90c8918f9fa5d7b62dc93862fb11b?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0MCwiaWF0IjoxNjExNDY1NzQwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE1MGU5MGM4OTE4ZjlmYTVkN2I2MmRjOTM4NjJmYjExYiJ9.SEfLw1-vVYby_NY3LYEYnKfREAXXVm7jDVRtplFzVFM&download=image.png "")

![](https://tcs.teambition.net/storage/3121848cfb317fcb84b139f0b3f4d1ee00ff?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0MCwiaWF0IjoxNjExNDY1NzQwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE4NDhjZmIzMTdmY2I4NGIxMzlmMGIzZjRkMWVlMDBmZiJ9.gGhcEsTRXlf8qAjFvmOa6cC83bDe4fu70XPFraikK50&download=image.png "")



指定配置的属性

超时时间 通过注解来配置

![](https://tcs.teambition.net/storage/31215a7bf084f0cea1906ac92b9fead70693?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0MCwiaWF0IjoxNjExNDY1NzQwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE1YTdiZjA4NGYwY2VhMTkwNmFjOTJiOWZlYWQ3MDY5MyJ9.FgUfpzeCIbvyt04-ZWieweTLK12608lgtT1yzjJ5JEg&download=image.png "")

![](https://tcs.teambition.net/storage/312165fa0d13f57539d5fb90b93d2de751be?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0MCwiaWF0IjoxNjExNDY1NzQwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE2NWZhMGQxM2Y1NzUzOWQ1ZmI5MGI5M2QyZGU3NTFiZSJ9.RlhMXJOkvOLg78AIwzhWBhKItkBiDnYGu6_Frvd7ax0&download=image.png "")

超时控制的name



![](https://tcs.teambition.net/storage/31217d4e636cb32a76b4eb3006db67cac2c3?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0MCwiaWF0IjoxNjExNDY1NzQwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE3ZDRlNjM2Y2IzMmE3NmI0ZWIzMDA2ZGI2N2NhYzJjMyJ9.1XY-g5OEjFftITQ3DwAScN6eu5CE82qA12cLNW9GuSA&download=image.png "")

![](https://tcs.teambition.net/storage/3121facafafa4d392d779ca52e8d891701c0?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0MCwiaWF0IjoxNjExNDY1NzQwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjFmYWNhZmFmYTRkMzkyZDc3OWNhNTJlOGQ4OTE3MDFjMCJ9.AYHkg857laIx8Gijkz0GGqQOuTsQnJ9cKcuNqBALeOw&download=image.png "")

![](https://tcs.teambition.net/storage/3121e667688260e993ee0ec7555f471266c5?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0MCwiaWF0IjoxNjExNDY1NzQwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjFlNjY3Njg4MjYwZTk5M2VlMGVjNzU1NWY0NzEyNjZjNSJ9.P2IH3fspcCFmRQCLPNfL5Drso6ArAD17rSwc1FtkEDU&download=image.png "")

![](https://tcs.teambition.net/storage/312182453dd8c05ae8f135d19cf2f288a2a4?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0MCwiaWF0IjoxNjExNDY1NzQwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE4MjQ1M2RkOGMwNWFlOGYxMzVkMTljZjJmMjg4YTJhNCJ9.ZROOZsjNAKnuNu4ZaSeqOUIO0FP4YH19w4096t5-f90&download=image.png "")

![](https://tcs.teambition.net/storage/31213c8da9fe4e23d74c7c026f08d0008d84?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0MCwiaWF0IjoxNjExNDY1NzQwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjEzYzhkYTlmZTRlMjNkNzRjN2MwMjZmMDhkMDAwOGQ4NCJ9.wB6-BPCAa8t6aOY0VNHipEcfsAQv5m7PMID-x0-NSvo&download=image.png "")

![](https://tcs.teambition.net/storage/312102f9796d8d23c353c474da83bad177c1?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0MCwiaWF0IjoxNjExNDY1NzQwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjEwMmY5Nzk2ZDhkMjNjMzUzYzQ3NGRhODNiYWQxNzdjMSJ9.w4_08hN7aIX-_iQB4h7LXN_z5_rizhXPjXK9rB6adIQ&download=image.png "")

这个全局配置超时作用在 myService.retry 方法上

![](https://tcs.teambition.net/storage/31217399e24ad8192101ccecb2f65f26ed76?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0MCwiaWF0IjoxNjExNDY1NzQwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE3Mzk5ZTI0YWQ4MTkyMTAxY2NlY2IyZjY1ZjI2ZWQ3NiJ9.PZWyK6SqBDH9imoIsfsEm2MxhSnr-8CVClpK8VVH4x0&download=image.png "")

当前这个方法是3秒

 方法中调用了其他方法

这个其他方法也有超时的配置

如果其他方法的超时配置 时间间隔更短 其他方法就会先起效 它有可能把访问请求导入到 当前调用的这个超时其他方法的 它指定的fallback方法 

![](https://tcs.teambition.net/storage/31210347cfec4eaf57b3a083cf5ecccb6312?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0MCwiaWF0IjoxNjExNDY1NzQwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjEwMzQ3Y2ZlYzRlYWY1N2IzYTA4M2NmNWVjY2NiNjMxMiJ9.rnDDU5sb_ae5QTXqComRqjALvqCmdZ942GCBAQwfhNg&download=image.png "")

这样超时时间有冲突了



启动

超时时间拉大

![](https://tcs.teambition.net/storage/31217bd237cfbd54889872f101c6a03e2968?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0MCwiaWF0IjoxNjExNDY1NzQwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE3YmQyMzdjZmJkNTQ4ODk4NzJmMTAxYzZhMDNlMjk2OCJ9.tqeT62QeN_cXcvrNezvDdll3kOKbs-_nGvTvRTr_8eU&download=image.png "")

![](https://tcs.teambition.net/storage/3121828070644d776fd0a00b65838bcae4dd?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0MCwiaWF0IjoxNjExNDY1NzQwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE4MjgwNzA2NDRkNzc2ZmQwYTAwYjY1ODM4YmNhZTRkZCJ9.YIPjQeIABRozRjRxvdjSE1gIUbVjsyKi2PzSCN5-zUY&download=image.png "")

![](https://tcs.teambition.net/storage/3121e6285fa99fa638e66cad3151c9f38da2?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0MCwiaWF0IjoxNjExNDY1NzQwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjFlNjI4NWZhOTlmYTYzOGU2NmNhZDMxNTFjOWYzOGRhMiJ9.10YFgdC8wktVTN4-JOJqSrbMz2OEUbrbSnT-mRuWQJk&download=image.png "")

![](https://tcs.teambition.net/storage/31210dfd0f91787a26e7802a5de3c8219f6b?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0MCwiaWF0IjoxNjExNDY1NzQwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjEwZGZkMGY5MTc4N2EyNmU3ODAyYTVkZTNjODIxOWY2YiJ9.2K85g0yYvugAnop-xWflrVojl9kxDKFk7VrKDakeSkk&download=image.png "")

```text
spring.application.name=hystrix-consumer
server.port=50000
spring.main.allow-bean-definition-overriding=true
eureka.client.serviceUrl.defaultZone=http://localhost:20000/eureka/

# 开启Feign下面的Hystrix功能
feign.hystrix.enabled=true
# 是否开启服务降级
hystrix.command.default.fallback.enabled=true

# 全局超时
hystrix.command.default.execution.timeout.enabled=true
# 超时时间 针对全局配置添加超时时间
hystrix.command.default.execution.isolation.thread.timeoutInMilliseconds=5000

# 线程中断行为
# 超时以后终止线程 配置超时行为
hystrix.command.default.execution.isolation.thread.interruptOnTimeout=true

# 取消的时候终止线程
hystrix.command.default.execution.isolation.thread.interruptOnFutureCancel=true

# 针对方法的配置
# Service的类名#方法名(方法参数)
# 方法级别的超时优先级高
hystrix.command.MyService#retry(int).execution.isolation.thread.timeoutInMilliseconds=3000

# 开启访问缓存功能
hystrix.command.default.requestCache.enabled=true


# hystrix的超时与ribbon的超时会有冲突
# 每台机器最大重试次数
feign-client.ribbon.MaxAutoRetries=0
# 可以再重试几台机器
feign-client.ribbon.MaxAutoRetriesNextServer=0
# 连接超时
feign-client.ribbon.ConnectTimeout=1000
# 业务处理超时
feign-client.ribbon.ReadTimeout=8000
# 在所有HTTP Method进行重试
feign-client.ribbon.OkToRetryOnAllOperations=false


```

![](https://tcs.teambition.net/storage/3121db907f9016381cef82f89e642d5ec2bc?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0MCwiaWF0IjoxNjExNDY1NzQwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjFkYjkwN2Y5MDE2MzgxY2VmODJmODllNjQyZDVlYzJiYyJ9.k25ZisoHNk9V0jFl_rPdvr-j5wyHyAU1E-ZZOqmQFsA&download=image.png "")

```java
package com.imooc.springcloud.hystrix;

import com.imooc.springcloud.Friend;
import com.imooc.springcloud.MyService;
import com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Component;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestParam;

/**
 * Fallback 针对MyService容错类
 */
@Slf4j
@Component
public class Fallback implements MyService {

    /**
     * 回调降级方法
     */
    @Override
    @HystrixCommand(fallbackMethod = "fallback2")
    public String error() {
        log.info("Fallback：I'm not a black sheep any more");
        throw new RuntimeException("first fallback");
    }

    @HystrixCommand(fallbackMethod = "fallback3")
    public String fallback2() {
        log.info("fallback again");
        throw new RuntimeException("fallback again");
    }

    public String fallback3() {
        log.info("fallback again and again");
        return "success";
    }

    @Override
    public String sayHi() {
        return null;
    }

    @Override
    public Friend sayHiPost(@RequestBody Friend friend) {
        return null;
    }

    @Override
    public String retry(@RequestParam(name="timeout") int timeout) {
        return "You are late !";
    }

}

```

![](https://tcs.teambition.net/storage/3121dce6f9a9faed69b7503455f415253782?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0MCwiaWF0IjoxNjExNDY1NzQwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjFkY2U2ZjlhOWZhZWQ2OWI3NTAzNDU1ZjQxNTI1Mzc4MiJ9.GuqP7tXaMMc87T558DZk87QNR-d17bSKfP7orQWan8k&download=image.png "")

```java
package com.imooc.springcloud;

import com.imooc.springcloud.hystrix.RequestCacheService;
import com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand;
import com.netflix.hystrix.contrib.javanica.annotation.HystrixProperty;
import com.netflix.hystrix.strategy.concurrency.HystrixRequestContext;
import lombok.Cleanup;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;


@RestController
public class Controller {

    @Autowired
    private MyService myService;

    @Autowired
    private RequestCacheService requestCacheService;

    @GetMapping("/fallback")
    public String fallback() {
        return myService.error();
    }

    @GetMapping("/timeout")
    public String timeout(Integer timeout) {
        return myService.retry(timeout);
    }

    @GetMapping("/timeout2")
    @HystrixCommand(
            fallbackMethod = "timeoutFallback",
            /**
             * 指定配置的属性
             * @HystrixProperty 指定单个配置属性 name 是 key value 是值
            */
            commandProperties = {
                @HystrixProperty(name="execution.isolation.thread.timeoutInMilliseconds",value="3000")
            }
    )
    public String timeout2(Integer timeout) {
        return myService.retry(timeout);
    }

    public String timeoutFallback(Integer timeout) {
        return "success";
    }


    @GetMapping("/cache")
    public Friend cache(String name) {

        @Cleanup HystrixRequestContext context =
                HystrixRequestContext.initializeContext();

        Friend friend = requestCacheService.requestCache(name);
        name += "!";
        friend = requestCacheService.requestCache(name);
        return friend;
    }


}

```

![](https://tcs.teambition.net/storage/31214110231795d7510208a0ffca9f61b17c?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0MCwiaWF0IjoxNjExNDY1NzQwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE0MTEwMjMxNzk1ZDc1MTAyMDhhMGZmY2E5ZjYxYjE3YyJ9.aq5TwcF-Tai_IwjTc6kpoNcs6CivxB3fZj7Bxv2sQE4&download=image.png "")

```java
package com.imooc.springcloud.hystrix;

import com.imooc.springcloud.Friend;
import com.imooc.springcloud.MyService;
import com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand;
import com.netflix.hystrix.contrib.javanica.cache.annotation.CacheKey;
import com.netflix.hystrix.contrib.javanica.cache.annotation.CacheResult;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;


@Slf4j
@Service
public class RequestCacheService {

    @Autowired
    private MyService service;

    @CacheResult
    @HystrixCommand(commandKey = "cacheKey")
    public Friend requestCache(@CacheKey String name) {
        log.info("request cache " + name);
        Friend friend = new Friend();
        friend.setName(name);
        friend = service.sayHiPost(friend);
        log.info("after requesting cache " + name);
        return friend;
    }

}

```

![](https://tcs.teambition.net/storage/3121b37aafd383aff807f6f3f64dccd20321?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0MCwiaWF0IjoxNjExNDY1NzQwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjFiMzdhYWZkMzgzYWZmODA3ZjZmM2Y2NGRjY2QyMDMyMSJ9.MGXXf-ufLCyrEv0haTlJ9bKR8UYi0i2lAtZGVy8734M&download=image.png "")

```java
package com.imooc.springcloud;

import org.springframework.boot.WebApplicationType;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.boot.builder.SpringApplicationBuilder;
import org.springframework.cloud.client.circuitbreaker.EnableCircuitBreaker;
import org.springframework.cloud.client.discovery.EnableDiscoveryClient;
import org.springframework.cloud.openfeign.EnableFeignClients;


@EnableDiscoveryClient
@SpringBootApplication
@EnableFeignClients
@EnableCircuitBreaker // 开启断路器
public class HystrixFallbackApplication {

    public static void main(String[] args) throws NoSuchMethodException {
        new SpringApplicationBuilder(HystrixFallbackApplication.class)
                .web(WebApplicationType.SERVLET)
                .run(args);
        /**
         * 生成方法签名
         * int 也可以class
         */
//        System.out.println(Feign.configKey(MyService.class,
//                MyService.class.getMethod("retry", int.class)));
    }

}

```

![](https://tcs.teambition.net/storage/31210baafbb270c44e272ea23e7c2bab3e2b?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0MCwiaWF0IjoxNjExNDY1NzQwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjEwYmFhZmJiMjcwYzQ0ZTI3MmVhMjNlN2MyYmFiM2UyYiJ9.VvB7Du_ZJ7gdNL4QrgeKg8_CKpHIMWbZ7T-auxm6WUo&download=image.png "")

```java
package com.imooc.springcloud;

import com.imooc.springcloud.hystrix.Fallback;
import org.springframework.cloud.openfeign.FeignClient;

/**
 * fallback  指定一个类来处理降级异常
 * MyService会将用户请求重新导到了当前Fallback类中 error方法
 */
@FeignClient(name = "feign-client", fallback = Fallback.class)
public interface MyService extends IService {

}

```

![](https://tcs.teambition.net/storage/312145828f949f045f7a56fb17080979c333?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0MCwiaWF0IjoxNjExNDY1NzQwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE0NTgyOGY5NDlmMDQ1ZjdhNTZmYjE3MDgwOTc5YzMzMyJ9.UrDc7dKLEKIaC20kaCxbbxfCMfo-16mPId41FNabGq8&download=image.png "")

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<configuration>
    <appender name="consoleLog" class="ch.qos.logback.core.ConsoleAppender">
        <filter class="ch.qos.logback.classic.filter.ThresholdFilter">
            <level>INFO</level>
        </filter>
        <layout class="ch.qos.logback.classic.PatternLayout">
            <pattern>
                [%d{HH:mm:ss.SSS}] %-5level %logger{15} - %msg%n
            </pattern>
        </layout>
    </appender>

    <appender name="fileLog" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <encoder>
            <pattern>
                [%d{HH:mm:ss.SSS}] %-5level [%thread]%logger{15} - %msg%n
            </pattern>
        </encoder>
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>logs/%d.log</fileNamePattern>
            <maxHistory>30</maxHistory>
        </rollingPolicy>
    </appender>
    <root level="DEBUG">
        <appender-ref ref = "consoleLog"/>
        <appender-ref ref = "fileLog"/>
    </root>
</configuration>
```

![](https://tcs.teambition.net/storage/312172570ef55c519557d514bef74aa9f1e3?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0MCwiaWF0IjoxNjExNDY1NzQwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjE3MjU3MGVmNTVjNTE5NTU3ZDUxNGJlZjc0YWE5ZjFlMyJ9.3u9Yq0nFs5M57ySHNoE9VKXiPzGg8BLYcEMSKPzK0zU&download=image.png "")

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <parent>
        <artifactId>spring-cloud-demo</artifactId>
        <groupId>com.imooc</groupId>
        <version>1.0-SNAPSHOT</version>
        <relativePath>../../pom.xml</relativePath>
    </parent>
    <modelVersion>4.0.0</modelVersion>
    <packaging>jar</packaging>
    <artifactId>hystrix-fallback</artifactId>

    <dependencies>

        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
        </dependency>

        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>

        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-actuator</artifactId>
        </dependency>

        <dependency>
            <groupId>com.imooc</groupId>
            <artifactId>feign-client-intf</artifactId>
            <version>${project.version}</version>
        </dependency>

        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-netflix-hystrix</artifactId>
        </dependency>
    </dependencies>

</project>
```



开源笔记

可 Pull Requests 协作写开源笔记

如果笔记图片无法访问 请访问 [teambition](https://tburl.in/0jDNvpbK) 原版开源笔记

gitee

[https://gitee.com/opendevel/java-for-linux](https://gitee.com/opendevel/java-for-linux)

github

[https://github.com/OSrcD/java-for-linux](https://github.com/OSrcD/java-for-linux)

teambition

[https://tburl.in/0jDNvpbK](https://tburl.in/0jDNvpbK)

开源视频

bilibili

[https://space.bilibili.com/77266754](https://space.bilibili.com/77266754)

开源博客

oschina

[https://my.oschina.net/u/4675154](https://my.oschina.net/u/4675154)

csdn

[https://blog.csdn.net/OpenDevel](https://blog.csdn.net/OpenDevel)

开源项目

gitee

[https://gitee.com/opendevel](https://gitee.com/opendevel)

github

[https://github.com/OSrcD](https://github.com/OSrcD)

开源赞赏

![](https://tcs.teambition.net/storage/3121aed56e96d914e1046f3b498b493ce232?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYxMjA3MDU0MCwiaWF0IjoxNjExNDY1NzQwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjFhZWQ1NmU5NmQ5MTRlMTA0NmYzYjQ5OGI0OTNjZTIzMiJ9.xeCS_mICLs-4Muv1XiJg0St9TXnLgQ4OBsjUT-xkjF8&download=image.png "")

